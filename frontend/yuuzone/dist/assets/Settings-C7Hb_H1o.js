import{a as le,u as ae,c as ie,A as se,i as Ae,r as n,Q as w,j as e,b as ye,S as Ue,D as Ee,F as ge,M as be}from"./vendor_react_core-CNRJGlP_.js";import{a as $}from"./vendor_axios-NIGUFBhG.js";import{a8 as pe,P as De}from"./vendor_other-Cv4PqGe0.js";import"./vendor_socket_io_client-ClWRkI5z.js";fe.propTypes={setModal:De.func};function fe({setModal:s}){const{t:i}=le(),x=ae(),r=ie(),{user:_}=se(),{getOwnedAvatars:N,clearAllCoinCache:l}=Ae(),[y,g]=n.useState(_.bio),[U,d]=n.useState(""),[a,v]=n.useState("image"),[p,k]=n.useState(""),[F,M]=n.useState(!1),[C,h]=n.useState(""),[f,m]=n.useState(!1),[t,T]=n.useState([]),[E,I]=n.useState(!1),[A,L]=n.useState(null),D=n.useCallback(c=>/(jpg|jpeg|png|webp|avif|gif|svg|image)/.test(c),[]);n.useCallback(c=>!c||typeof c!="string"?!1:/\.(mp4|webm|ogg|avi|mov|wmv|flv|mkv)(\?.*)?$/i.test(c)?!0:[/youtube\.com|youtu\.be/i,/vimeo\.com/,/dailymotion\.com/,/facebook\.com.*\/videos/,/twitch\.tv/,/streamable\.com/,/tiktok\.com/,/instagram\.com.*\/reel/,/twitter\.com.*\/video/,/x\.com.*\/video/].some(Y=>Y.test(c)),[]);const b=n.useCallback(()=>{let c="";a==="image"&&U?c=URL.createObjectURL(U):a==="url"&&p?c=p:a==="available_avatar"&&A&&(c=A.avatar_data.image_url),c&&(h(c),M(!0))},[a,U,p,A]),u=n.useCallback(()=>{M(!1),a==="image"&&U&&C.startsWith("blob:")&&URL.revokeObjectURL(C)},[a,U,C]),W=n.useCallback(c=>{c.target===c.currentTarget&&u()},[u]),Q=n.useCallback(async()=>{try{I(!0),console.log("ðŸ” Fetching owned avatars..."),l&&l();const c=await N();if(console.log("ðŸ” getOwnedAvatars returned:",c),c){const B=c.avatars||c;console.log("ðŸ” Setting avatars:",B),console.log("ðŸ” Avatars type:",typeof B),console.log("ðŸ” Avatars is array:",Array.isArray(B)),console.log("ðŸ” Avatars length:",B==null?void 0:B.length),T(B)}else console.log("ðŸ” No avatar data returned"),T([])}catch(c){console.error("ðŸ” Error fetching avatars:",c),w.error(i("coins.fetchError")),T([])}finally{I(!1)}},[i,N,l]),Z=n.useCallback(c=>{L(c),m(!1)},[]);n.useEffect(()=>{a!=="available_avatar"?(L(null),m(!1)):m(!0)},[a]),n.useEffect(()=>{f&&(!t||!Array.isArray(t)||t.length===0)&&Q()},[f,t==null?void 0:t.length,Q]);async function X(c){c==null||c.preventDefault();const B=new FormData;B.append("bio",y),B.append("content_type",a),B.append("content_url",p),a==="image"&&U?B.append("avatar",U,U.name):a==="available_avatar"&&A&&B.append("avatar_id",A.avatar_id),await $.patch("/api/user",B,{headers:{"Content-Type":"multipart/form-data"}}).then(V=>{s(!1),x.setQueryData(["user",_.username],()=>V.data),x.setQueryData(["user"],()=>V.data)}).catch(V=>w.error(`${V.message} ${i("alerts.checkYourFields")}`))}return n.useEffect(()=>(pe.setFocused(!1),()=>{pe.setFocused(!0),C&&C.startsWith("blob:")&&URL.revokeObjectURL(C)}),[C]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col p-5 space-y-5 w-5/6 rounded-md min-h-3/6 md:w-3/4 md:p-10 bg-theme-light-gray2 dark:bg-theme-dark-card dark:text-theme-dark-text",children:[e.jsxs("div",{className:"flex flex-col justify-between items-center p-4 space-y-3 bg-theme-less-white dark:bg-theme-dark-bg rounded-lg md:flex-row md:space-y-0",children:[e.jsx("p",{className:"text-theme-text-primary dark:text-theme-dark-text",children:"Updating Profile for"}),e.jsx("img",{src:_.avatar||ye,className:"object-cover w-10 h-10 rounded-md md:w-14 md:h-14",alt:""}),e.jsx("p",{className:"text-theme-text-primary dark:text-theme-dark-text",children:_.username})]}),e.jsxs("form",{className:"flex flex-col p-5 space-y-5 bg-theme-less-white dark:bg-theme-dark-bg rounded-md",onSubmit:X,children:[e.jsxs("label",{htmlFor:"bio",className:"flex flex-col p-2 md:space-x-3 md:flex-row",children:[e.jsx("span",{className:"text-sm font-light text-theme-text-primary dark:text-theme-dark-text",children:"Bio"}),e.jsx("textarea",{value:y,onChange:c=>g(c.target.value),type:"text",name:"bio",id:"bio",className:"w-full h-20 max-h-28 border-b border-gray-800 dark:border-theme-dark-border focus:outline-none bg-transparent dark:text-theme-dark-text dark:placeholder-theme-dark-placeholder-80"})]}),e.jsxs("label",{htmlFor:"media",className:"flex flex-col items-center space-y-3 md:space-y-0 md:space-x-5 md:flex-row",children:[e.jsxs("select",{className:"px-10 py-2 bg-theme-less-white dark:bg-theme-dark-bg rounded-md border dark:border-theme-dark-border md:px-12 dark:text-theme-dark-text",name:"media",id:"media",onChange:c=>v(c.target.value),children:[e.jsx("option",{value:"image",className:"dark:bg-theme-dark-bg dark:text-theme-dark-text",children:"Image"}),e.jsx("option",{value:"url",className:"dark:bg-theme-dark-bg dark:text-theme-dark-text",children:"URL"}),e.jsx("option",{value:"available_avatar",className:"dark:bg-theme-dark-bg dark:text-theme-dark-text",children:i("coins.availableAvatar")})]}),a==="image"?e.jsx("input",{onChange:c=>{c.target.files[0].size>10485760?w.error(i("alerts.fileTooLarge")):d(c.target.files[0])},type:"file",name:"file",accept:"image/*",id:"image",className:"w-full focus:outline-none dark:text-theme-dark-text"}):a==="url"?e.jsx("input",{type:"text",name:"media_url",id:"media_url",className:"p-2 w-full rounded-md border border-gray-800 dark:border-theme-dark-border focus:outline-none bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:placeholder-theme-dark-placeholder-80",onChange:c=>k(c.target.value)}):e.jsx("div",{className:"flex flex-col space-y-2 w-full",children:A?e.jsxs("div",{className:"flex items-center space-x-3 p-2 bg-theme-light-gray2 dark:bg-theme-dark-bg rounded-md",children:[e.jsx("img",{src:A.avatar_data.image_url,alt:A.avatar_data.name,className:"w-12 h-12 rounded-md object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-theme-text-primary dark:text-theme-dark-text",children:A.avatar_data.name}),e.jsx("p",{className:"text-xs text-theme-text-secondary dark:text-theme-dark-text-secondary",children:i("coins.chooseFromOwned")})]}),e.jsx("button",{type:"button",onClick:()=>L(null),className:"text-red-500 hover:text-red-700",children:"Ã—"})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2 px-4 py-2 bg-theme-light-gray2 dark:bg-theme-dark-bg rounded-md border border-gray-300 dark:border-theme-dark-border",children:[e.jsx(Ue,{type:"user",className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-theme-dark-text-secondary",children:i("coins.selectAvatar")})]})})]}),a==="image"&&U||a==="url"&&p||a==="available_avatar"&&A?e.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 bg-theme-bg-secondary dark:bg-theme-dark-bg text-theme-text-primary dark:text-theme-dark-text rounded-md hover:bg-theme-bg-tertiary dark:hover:bg-theme-dark-card transition-colors",children:i("coins.previewAvatar")}):null,e.jsx("span",{className:"text-sm font-semibold text-red-500 dark:text-red-400",children:"Only Add Image if you want to modify the original image if empty the original will be used."}),e.jsx("button",{onClick:X,className:"py-2 font-semibold text-white rounded-md bg-theme-blue active:scale-95 dark:bg-theme-blue dark:hover:bg-theme-blue-coral",children:i("common.submit")})]})]}),f&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-theme-less-white dark:bg-theme-dark-card p-6 rounded-md shadow-md max-w-4xl w-full max-h-[80vh] overflow-y-auto dark:text-theme-dark-text",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold dark:text-theme-dark-text-secondary",children:i("coins.selectAvatar")}),e.jsx("button",{onClick:()=>m(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"Ã—"})]}),E?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-4 border-theme-blue border-t-transparent rounded-full animate-spin"})}):!t||!Array.isArray(t)||t.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"ðŸ‘¤"}),e.jsx("h4",{className:"text-lg font-medium text-theme-text-primary dark:text-theme-dark-text mb-2",children:i("coins.noAvatarsOwned")}),e.jsx("p",{className:"text-theme-text-secondary dark:text-theme-dark-text-secondary mb-4",children:i("coins.noAvatarsDescription")}),e.jsx("button",{onClick:()=>{m(!1),r("/coin-shop")},className:"bg-theme-blue text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-colors",children:i("coins.goToAvatarShop")})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(t||[]).map(c=>{const B=c.avatar_data;return B?e.jsx("div",{className:`bg-theme-bg-primary dark:bg-theme-dark-bg rounded-lg border-2 p-4 hover:shadow-lg transition-shadow cursor-pointer ${c.is_equipped?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-theme-border-light dark:border-theme-dark-border"}`,onClick:()=>Z(c),children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx("img",{src:B.image_url,alt:B.name,className:"w-20 h-20 mx-auto rounded-lg object-cover",onError:V=>{V.target.src="https://via.placeholder.com/80x80?text=Avatar"}}),c.is_equipped&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs",children:"âœ“"})]}),e.jsx("h4",{className:"text-sm font-medium text-theme-text-primary dark:text-theme-dark-text mb-1",children:B.name}),e.jsx("p",{className:"text-xs text-theme-text-secondary dark:text-theme-dark-text-secondary",children:c.is_equipped?i("coins.equipped"):i("coins.owned")})]})},c.id):null})})]})}),e.jsx(Ee,{children:F&&e.jsx(ge.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-50",onClick:W,children:e.jsxs(ge.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"relative max-w-4xl max-h-[90vh] overflow-auto bg-white dark:bg-theme-dark-card rounded-lg shadow-xl",onClick:c=>c.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-theme-dark-border",children:[e.jsx("h3",{className:"text-lg font-semibold text-theme-text-primary dark:text-theme-dark-text",children:i("coins.previewAvatar")}),e.jsx("button",{onClick:u,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl",children:"Ã—"})]}),e.jsx("div",{className:"relative",children:D(C)?e.jsx("div",{className:"relative",children:e.jsx("img",{src:C,alt:"Preview",className:"max-w-full max-h-[70vh] object-contain"})}):e.jsx("div",{className:"relative w-full h-96",children:e.jsx("iframe",{src:C,className:"w-full h-full",frameBorder:"0",allowFullScreen:!0,title:"Video Preview"})})})]})})})]})}const Me=({disableModal:s=!1,onThemeCreated:i=null,themeSlotsData:x=null})=>{const{t:r}=le(),_=se(),{switchToCustomTheme:N,switchToSystemTheme:l}=_,[y,g]=n.useState([]),[U,d]=n.useState(!0),[a,v]=n.useState({available:0,used:0,total:0}),[p,k]=n.useState(!1),[F,M]=n.useState(!1),[C,h]=n.useState(null),[f,m]=n.useState({theme_name:"",theme_data:{}}),[t,T]=n.useState(!1),[E,I]=n.useState(null),[A,L]=n.useState(null),D={"theme-text-primary":"var(--theme-text-primary, #374151)","theme-text-secondary":"var(--theme-text-secondary, #6b7280)","theme-text-muted":"var(--theme-text-muted, #9ca3af)","theme-bg-primary":"var(--theme-bg-primary, #ffffff)","theme-bg-secondary":"var(--theme-bg-secondary, #f9fafb)","theme-bg-tertiary":"var(--theme-bg-tertiary, #f3f4f6)","theme-less-white":"var(--theme-less-white, #f4f4f4)","theme-light-gray2":"var(--theme-light-gray2, #dfdfdf)","theme-light-gray3":"var(--theme-light-gray3, #e7e5e5)","theme-pale-gray":"var(--theme-pale-gray, #eaeaea)","theme-border-light":"var(--theme-border-light, #e5e7eb)","theme-border-medium":"var(--theme-border-medium, #d1d5db)","theme-light-gray":"var(--theme-light-gray, #d9d9d9)","theme-blue":"var(--theme-blue, #37affe)","theme-blue-coral":"var(--theme-blue-coral, #3172ff)","theme-button-primary":"var(--theme-button-primary, #2563eb)","theme-button-primary-hover":"var(--theme-button-primary-hover, #1d4ed8)","theme-button-active":"var(--theme-button-active, #1e40af)","theme-button-disabled":"var(--theme-button-disabled, #9ca3af)","theme-link":"var(--theme-link, #2563eb)","theme-link-hover":"var(--theme-link-hover, #1d4ed8)","theme-success":"var(--theme-success, #059669)","theme-success-light":"var(--theme-success-light, #d1fae5)","theme-error":"var(--theme-error, #dc2626)","theme-error-light":"var(--theme-error-light, #fef2f2)","theme-warning":"var(--theme-warning, #d97706)","theme-warning-light":"var(--theme-warning-light, #fef3c7)","theme-info":"var(--theme-info, #2563eb)","theme-gray-blue":"var(--theme-gray-blue, #22638f)","theme-cultured":"var(--theme-cultured, #004b96)","theme-light-blue":"var(--theme-light-blue, #69bcff)","theme-pale-blue":"var(--theme-pale-blue, #93ceff)","theme-received":"var(--theme-received, #43b751)","theme-sender":"var(--theme-sender, #47acde)","theme-online":"var(--theme-online, #10b981)","theme-comment-border-1":"var(--theme-comment-border-1, #fbbf24)","theme-comment-border-2":"var(--theme-comment-border-2, #60a5fa)","theme-comment-border-3":"var(--theme-comment-border-3, #a78bfa)","theme-comment-border-4":"var(--theme-comment-border-4, #34d399)","theme-comment-border-5":"var(--theme-comment-border-5, #38bdf8)","theme-comment-border-6":"var(--theme-comment-border-6, #f472b6)"},b={"Text Colors":["theme-text-primary","theme-text-secondary","theme-text-muted"],"Page & Background":["theme-bg-primary","theme-bg-secondary","theme-bg-tertiary","theme-less-white"],"Cards & Containers":["theme-light-gray2","theme-light-gray3","theme-pale-gray"],"Borders & Dividers":["theme-border-light","theme-border-medium","theme-light-gray"],"Buttons & Interactive":["theme-blue","theme-blue-coral","theme-button-primary","theme-button-primary-hover","theme-button-active","theme-button-disabled"],Links:["theme-link","theme-link-hover"],"Status & Messages":["theme-success","theme-success-light","theme-error","theme-error-light","theme-warning","theme-warning-light","theme-info"],"Navigation & Brand":["theme-gray-blue","theme-cultured","theme-light-blue","theme-pale-blue"],"Chat & Messaging":["theme-received","theme-sender","theme-online"],"Comment Threads":["theme-comment-border-1","theme-comment-border-2","theme-comment-border-3","theme-comment-border-4","theme-comment-border-5","theme-comment-border-6"]};n.useEffect(()=>{x?(v({available:x.available_slots,used:x.used_slots,total:x.total_slots}),d(!1)):u(),W()},[x]);const u=async()=>{try{const o=await $.get("/api/subscriptions/themes/slots");v(o.data)}catch(o){console.error("Error fetching theme slots:",o)}},W=async()=>{try{d(!0);const o=await $.get("/api/subscriptions/themes");g(o.data.themes)}catch(o){console.error("Error fetching themes:",o),w.error(r("themes.errorLoadingThemes"))}finally{d(!1)}},Q=async o=>{o.preventDefault();try{const S=await $.post("/api/subscriptions/themes",{theme_name:f.theme_name,theme_data:f.theme_data});w.success(r("themes.themeCreated")),t&&G(),k(!1),M(!1),m({theme_name:"",theme_data:{}}),W(),u(),i&&i()}catch(S){console.error("Error creating theme:",S),w.error(r("themes.errorCreatingTheme"))}},Z=async o=>{o.preventDefault();try{const S=await $.put(`/api/subscriptions/themes/${C.id}`,{theme_name:f.theme_name,theme_data:f.theme_data});w.success(r("themes.themeUpdated")),t&&G(),k(!1),h(null),m({theme_name:"",theme_data:{}}),W()}catch(S){console.error("Error updating theme:",S),w.error(r("themes.errorUpdatingTheme"))}},X=async o=>{if(window.confirm(r("themes.confirmDeleteTheme")))try{await $.delete(`/api/subscriptions/themes/${o}`),w.success(r("themes.themeDeleted")),W(),u()}catch(S){console.error("Error deleting theme:",S),w.error(r("themes.errorDeletingTheme"))}},c=async o=>{try{const j=(await $.post(`/api/subscriptions/themes/${o}/activate`)).data.theme;N&&typeof N=="function"?N(j):console.error("switchToCustomTheme function not available"),w.success(r("themes.themeActivated")),W()}catch(S){console.error("Error activating theme:",S),w.error(r("themes.errorActivatingTheme"))}},B=async()=>{try{await $.post("/api/subscriptions/themes/deactivate"),l&&typeof l=="function"?l():console.error("switchToSystemTheme function not available"),w.success(r("themes.themesDeactivated")),W()}catch(o){console.error("Error deactivating themes:",o),w.error(r("themes.errorDeactivatingThemes"))}},V=o=>{h(o),m({theme_name:o.theme_name,theme_data:{...o.theme_data}})},Y=()=>{t&&G(),k(!1),M(!1),h(null),m({theme_name:"",theme_data:{}})},ee=(o,S)=>{m(j=>({...j,theme_data:{...j.theme_data,[o]:S}})),t&&I(j=>({...j,[o]:S}))},J=()=>{L(_.customTheme);const o={...f.theme_data};I(o),N&&typeof N=="function"&&N({id:"preview",theme_name:f.theme_name||"Preview Theme",theme_data:o}),T(!0),w.success(r("themes.previewStarted"))},G=()=>{A?N&&typeof N=="function"&&N(A):l&&typeof l=="function"&&l(),T(!1),I(null),L(null),w.success(r("themes.previewStopped"))};n.useEffect(()=>()=>{t&&G()},[t]);const te=o=>({"theme-text-primary":"Main Text & Headings","theme-text-secondary":"Secondary Text & Captions","theme-text-muted":"Muted Text & Placeholders","theme-bg-primary":"Primary Background","theme-bg-secondary":"Secondary Background","theme-bg-tertiary":"Tertiary Background","theme-less-white":"Page Background","theme-light-gray2":"Background Cards","theme-light-gray3":"Secondary Borders","theme-pale-gray":"Button Hover Backgrounds","theme-border-light":"Light Borders","theme-border-medium":"Medium Borders","theme-light-gray":"Light Borders & Dividers","theme-blue":"Main Buttons & Links","theme-blue-coral":"Button Hover States","theme-button-primary":"Primary Buttons","theme-button-primary-hover":"Primary Button Hover","theme-button-active":"Active Button States","theme-button-disabled":"Disabled Buttons","theme-link":"Links","theme-link-hover":"Link Hover States","theme-success":"Success Messages & Confirmations","theme-success-light":"Success Backgrounds","theme-error":"Error Messages & Delete Buttons","theme-error-light":"Error Backgrounds","theme-warning":"Warning Messages & Alerts","theme-warning-light":"Warning Backgrounds","theme-info":"Info Messages","theme-gray-blue":"Navigation & Sidebar","theme-cultured":"Deep Blue Accents","theme-light-blue":"Light Blue Elements","theme-pale-blue":"Pale Blue Backgrounds","theme-received":"Received Message Background","theme-sender":"Sent Message Background","theme-online":"Online Status Indicator","theme-comment-border-1":"Comment Thread Border 1","theme-comment-border-2":"Comment Thread Border 2","theme-comment-border-3":"Comment Thread Border 3","theme-comment-border-4":"Comment Thread Border 4","theme-comment-border-5":"Comment Thread Border 5","theme-comment-border-6":"Comment Thread Border 6"})[o]||o.replace(/-/g," ").replace(/\b\w/g,j=>j.toUpperCase());if(U)return e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-theme-blue"})});const re=!U&&a.total>0;return F||a.available>0&&(!y||!Array.isArray(y)||y.length===0)?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-theme-dark-bg p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:["ðŸŽ¨ ",r("themes.createNewTheme")]}),t&&e.jsx("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full font-medium",children:r("themes.previewMode")})]}),e.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:r("themes.previewDescription")})}),e.jsxs("form",{onSubmit:Q,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:r("themes.themeName")}),e.jsx("input",{type:"text",value:f.theme_name,onChange:o=>m(S=>({...S,theme_name:o.target.value})),className:"w-full p-2 border border-gray-300 dark:border-theme-dark-border rounded-md bg-white dark:bg-theme-dark-bg text-gray-900 dark:text-gray-100",placeholder:"Enter theme name",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:[r("themes.colorPalette")," - ",r("themes.allColorsAvailable")]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-6",children:Object.entries(b).map(([o,S])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-3 text-sm uppercase tracking-wide",children:o}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:S.map(j=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"color",value:f.theme_data[j]||D[j],onChange:K=>ee(j,K.target.value),className:"w-8 h-8 border border-gray-300 rounded"}),t&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:te(j)}),e.jsx("div",{className:"w-full h-2 rounded mt-1 border border-gray-200",style:{backgroundColor:f.theme_data[j]||D[j]}})]})]},j))})]},o))})]}),e.jsxs("div",{className:"flex space-x-3",children:[t?e.jsx("button",{type:"button",onClick:G,className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.stopPreview")}):e.jsx("button",{type:"button",onClick:J,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.previewTheme")}),e.jsx("button",{type:"submit",className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-4 py-2 rounded-md transition-colors",children:r("themes.createTheme")}),e.jsx("button",{type:"button",onClick:()=>M(!1),className:"bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-md transition-colors",children:r("common.cancel")})]})]})]})}):(p||C)&&s?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:r(C?"themes.editTheme":"themes.createNewTheme")}),t&&e.jsx("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full font-medium",children:r("themes.previewMode")})]}),e.jsx("button",{onClick:Y,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:C?Z:Q,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:r("themes.themeName")}),e.jsx("input",{type:"text",value:f.theme_name,onChange:o=>m(S=>({...S,theme_name:o.target.value})),className:"w-full p-2 border border-gray-300 dark:border-theme-dark-border rounded-md bg-white dark:bg-theme-dark-bg text-gray-900 dark:text-gray-100",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[r("themes.colorPalette")," - ",r("themes.allColorsAvailable")]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-6",children:Object.entries(b).map(([o,S])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-3 text-sm uppercase tracking-wide",children:o}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:S.map(j=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"color",value:f.theme_data[j]||D[j],onChange:K=>ee(j,K.target.value),className:"w-8 h-8 border border-gray-300 rounded"}),t&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:te(j)}),e.jsx("div",{className:"w-full h-2 rounded mt-1 border border-gray-200",style:{backgroundColor:f.theme_data[j]||D[j]}})]})]},j))})]},o))})]}),e.jsxs("div",{className:"flex space-x-3",children:[t?e.jsx("button",{type:"button",onClick:G,className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.stopPreview")}):e.jsx("button",{type:"button",onClick:J,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.previewTheme")}),e.jsx("button",{type:"submit",className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-4 py-2 rounded-md transition-colors",children:r(C?"themes.updateTheme":"themes.createTheme")}),e.jsx("button",{type:"button",onClick:Y,className:"bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-md transition-colors",children:r("common.cancel")})]})]})]}):!U&&!re?e.jsxs("div",{className:"space-y-6 opacity-50 pointer-events-none",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h4",{className:"text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200",children:r("themes.customThemes")})}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-6 text-center",children:[e.jsx("div",{className:"text-gray-400 text-4xl mb-4",children:"ðŸŽ¨"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 dark:text-gray-400 mb-2",children:r("themes.customThemesLocked")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500 mb-4",children:r("themes.upgradeRequiredForThemes")}),e.jsx("button",{onClick:()=>window.location.href="/subscriptions",className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-6 py-2 rounded-md transition-colors pointer-events-auto",children:r("themes.upgradeToCreateThemes")})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-theme-light-gray2 dark:bg-theme-dark-bg rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:r("themes.themeSlots")}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[a.used>0?e.jsx("span",{children:r("themes.slotsLeft",{count:a.available})}):e.jsx("span",{children:r("themes.availableSlots",{count:a.available})}),e.jsx("span",{children:r("themes.usedSlots",{count:a.used})}),e.jsx("span",{children:r("themes.totalSlots",{count:a.total})})]}),y.some(o=>o.is_active)&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:r("themes.customThemeModeDescription")})]}),a.available===0&&a.total>0&&e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-6 text-center",children:[e.jsx("div",{className:"text-orange-600 dark:text-orange-400 text-4xl mb-4",children:"ðŸ“"}),e.jsx("h3",{className:"text-lg font-semibold text-orange-800 dark:text-orange-200 mb-2",children:r("themes.allSlotsUsedTitle")}),e.jsx("p",{className:"text-orange-700 dark:text-orange-300 mb-4",children:r("themes.allSlotsUsedMessage")}),e.jsxs("div",{className:"flex space-x-3 justify-center",children:[e.jsx("button",{onClick:()=>window.location.href="/subscriptions",className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-4 py-2 rounded-md transition-colors",children:r("themes.upgradeForMoreSlots")}),e.jsx("button",{onClick:()=>k(!0),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.manageExistingThemes")})]})]}),a.available>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:r("themes.yourThemes")}),e.jsx("button",{onClick:()=>{k(!0),M(!0)},className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-4 py-2 rounded-md transition-colors",children:r("themes.createNewTheme")})]}),y&&Array.isArray(y)&&y.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(y||[]).map(o=>e.jsxs("div",{className:"bg-white dark:bg-theme-dark-card rounded-lg p-4 border border-gray-200 dark:border-theme-dark-border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200",children:o.theme_name}),o.is_active&&e.jsx("span",{className:"bg-theme-success text-white text-xs px-2 py-1 rounded-full",children:r("themes.active")})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1 mb-3",children:Object.entries(o.theme_data).slice(0,8).map(([S,j])=>e.jsx("div",{className:"w-6 h-6 rounded border border-gray-300",style:{backgroundColor:j},title:te(S)},S))}),e.jsxs("div",{className:"flex space-x-2",children:[!o.is_active&&e.jsx("button",{onClick:()=>c(o.id),className:"bg-theme-success hover:bg-theme-success-light text-white px-3 py-1 rounded text-sm transition-colors",children:r("themes.activate")}),e.jsx("button",{onClick:()=>V(o),className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-3 py-1 rounded text-sm transition-colors",children:r("themes.edit")}),e.jsx("button",{onClick:()=>X(o.id),className:"bg-theme-error hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors",children:r("themes.delete")})]})]},o.id))}),(!y||!Array.isArray(y)||y.length===0)&&a.available>0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-400 dark:text-gray-500 text-4xl mb-3",children:"ðŸŽ¨"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:r("themes.noThemesYet")}),e.jsx("button",{onClick:()=>{k(!0),M(!0)},className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-6 py-2 rounded-md transition-colors",children:r("themes.createFirstTheme")})]}),(p||C)&&!s&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-theme-dark-card rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:r(C?"themes.editTheme":"themes.createNewTheme")}),t&&e.jsx("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full font-medium",children:r("themes.previewMode")})]})}),e.jsxs("form",{onSubmit:C?Z:Q,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:r("themes.themeName")}),e.jsx("input",{type:"text",value:f.theme_name,onChange:o=>m(S=>({...S,theme_name:o.target.value})),className:"w-full p-2 border border-gray-300 dark:border-theme-dark-border rounded-md bg-white dark:bg-theme-dark-bg text-gray-900 dark:text-gray-100",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[r("themes.colorPalette")," - ",r("themes.allColorsAvailable")]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-6",children:Object.entries(b).map(([o,S])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-3 text-sm uppercase tracking-wide",children:o}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:S.map(j=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"color",value:f.theme_data[j]||D[j],onChange:K=>ee(j,K.target.value),className:"w-8 h-8 border border-gray-300 rounded"}),t&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:te(j)}),e.jsx("div",{className:"w-full h-2 rounded mt-1 border border-gray-200",style:{backgroundColor:f.theme_data[j]||D[j]}})]})]},j))})]},o))})]}),e.jsxs("div",{className:"flex space-x-3",children:[t?e.jsx("button",{type:"button",onClick:G,className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.stopPreview")}):e.jsx("button",{type:"button",onClick:J,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.previewTheme")}),e.jsx("button",{type:"submit",className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-4 py-2 rounded-md transition-colors",children:r(C?"themes.updateTheme":"themes.createTheme")}),e.jsx("button",{type:"button",onClick:Y,className:"bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-md transition-colors",children:r("common.cancel")})]})]})]})}),y.some(o=>o.is_active)&&e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:B,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.deactivateAllThemes")})})]})};let Be=!1,H=null;function Le(){const{socket:s,user:i}=se(),x=ae(),[r,_]=n.useState(null),[N,l]=n.useState(!1),y=n.useRef(!1),g=n.useCallback(async(a=!1)=>{if(H&&!a&&!y.current)return _(H),y.current=!0,H;if(y.current&&!a)return r;l(!0);try{const p=(await $.get("/api/translate/stats")).data;return H=p,Be=!0,y.current=!0,_(p),x.setQueryData(["translation/stats"],p),p}catch{return null}finally{l(!1)}},[x,r]),U=n.useCallback(async()=>await g(!0),[g]),d=n.useCallback(a=>{const{used_count:v,limit:p,reset_date:k}=a;H={...H,used_count:v||(H==null?void 0:H.used_count),limit:p||(H==null?void 0:H.limit),reset_date:k||(H==null?void 0:H.reset_date)},y.current&&_(H),x.setQueryData(["translation/stats"],H),x.invalidateQueries(["translation/history"])},[x]);return n.useEffect(()=>{if(!(!s||!i))return s.on("translation_stats_updated",d),s.emit("join_room",`user_settings_${i.id}`),()=>{s.off("translation_stats_updated",d),s.emit("leave_room",`user_settings_${i.id}`)}},[s,i,d]),{translationStats:r,loadingStats:N,fetchTranslationStats:g,refreshTranslationStats:U}}function $e(){const{socket:s}=se(),i=ae(),x=n.useCallback(d=>{const{purchase_type:a,purchase_data:v}=d,p=new CustomEvent("purchaseHistoryUpdated",{detail:{type:"new_purchase",purchaseType:a,purchaseData:v}});window.dispatchEvent(p)},[]),r=n.useCallback(d=>{const{purchase_id:a,purchase_type:v,new_status:p}=d,k=new CustomEvent("purchaseHistoryUpdated",{detail:{type:"status_update",purchaseId:a,purchaseType:v,newStatus:p}});window.dispatchEvent(k)},[]),_=n.useCallback(d=>{const{tier_name:a,tier_slug:v,amount:p,currency:k,payment_status:F}=d,M=new CustomEvent("purchaseHistoryUpdated",{detail:{type:"new_purchase",purchaseType:"subscription",purchaseData:{id:`sub_${Date.now()}`,type:"subscription",tier_name:a,tier_slug:v,amount:p,currency:k,payment_status:F,created_at:new Date().toISOString(),description:`Subscription to ${a}`}}});window.dispatchEvent(M)},[]),N=n.useCallback(d=>{const{package_name:a,coin_amount:v,amount:p,currency:k,payment_status:F}=d,M=new CustomEvent("purchaseHistoryUpdated",{detail:{type:"new_purchase",purchaseType:"coin_purchase",purchaseData:{id:`coin_${Date.now()}`,type:"coin_purchase",package_name:a,coin_amount:v,amount:p,currency:k,payment_status:F,created_at:new Date().toISOString(),description:`Purchased ${v} coins`}}});window.dispatchEvent(M)},[]),l=n.useCallback(d=>{const{avatar_name:a,price_coins:v,avatar_image:p}=d,k=new CustomEvent("purchaseHistoryUpdated",{detail:{type:"new_purchase",purchaseType:"avatar_purchase",purchaseData:{id:`avatar_${Date.now()}`,type:"avatar_purchase",avatar_name:a,price_coins:v,avatar_image:p,created_at:new Date().toISOString(),description:`Purchased avatar: ${a}`}}});window.dispatchEvent(k)},[]),y=n.useCallback(d=>{const{post_id:a,cost:v}=d;if(a){const k=["top","hot","new"],F=["day","week","month","year","alltime"],M=[["posts","all"],["posts","popular"],["posts","home"],["post",a]];["all","popular","home"].forEach(C=>{k.forEach(h=>{F.forEach(f=>{M.push(["posts",C,h,f])})})}),M.forEach(C=>{i.setQueryData(C,h=>{var f;return h&&(h.pages?{...h,pages:h.pages.map(m=>Array.isArray(m)?m.map(t=>{var T;return t.id===a||((T=t.post_info)==null?void 0:T.id)===a?{...t,is_boosted:!0}:t}):m)}:Array.isArray(h)?h.map(m=>{var t;return m.id===a||((t=m.post_info)==null?void 0:t.id)===a?{...m,is_boosted:!0}:m}):h.id===a||((f=h.post_info)==null?void 0:f.id)===a?{...h,is_boosted:!0}:h)})})}const p=new CustomEvent("purchaseHistoryUpdated",{detail:{type:"new_purchase",purchaseType:"post_boost",purchaseData:{id:`boost_${Date.now()}`,type:"post_boost",post_id:a,amount:-v,created_at:new Date().toISOString(),description:`Boosted post #${a}`}}});window.dispatchEvent(p)},[i]),g=n.useCallback(d=>{const{tier_name:a,tier_slug:v,cost:p}=d,k=new CustomEvent("purchaseHistoryUpdated",{detail:{type:"new_purchase",purchaseType:"tier_purchase",purchaseData:{id:`tier_${Date.now()}`,type:"tier_purchase",tier_name:a,tier_slug:v,amount:-p,created_at:new Date().toISOString(),description:`Purchased tier: ${a}`}}});window.dispatchEvent(k)},[]);return n.useEffect(()=>{if(s)return s.on("new_purchase",x),s.on("purchase_status_updated",r),s.on("subscription_purchased",_),s.on("coin_purchase_complete",N),s.on("avatar_purchased",l),s.on("post_boosted",y),s.on("tier_purchased",g),()=>{s.off("new_purchase",x),s.off("purchase_status_updated",r),s.off("subscription_purchased",_),s.off("coin_purchase_complete",N),s.off("avatar_purchased",l),s.off("post_boosted",y),s.off("tier_purchased",g)}},[s,x,r,_,N,l,y,g]),{emitPurchaseUpdate:n.useCallback(d=>{s&&s.emit("purchase_update",d)},[s])}}const Fe=({user:s,language:i,handleLanguageChange:x,showUpdateProfile:r,setShowUpdateProfile:_,newUsername:N,setNewUsername:l,newPassword:y,setNewPassword:g,confirmPassword:U,setConfirmPassword:d,newEmail:a,setNewEmail:v,currentPassword:p,setCurrentPassword:k,showChangeUsername:F,setShowChangeUsername:M,showChangePassword:C,setShowChangePassword:h,showChangeEmail:f,setShowChangeEmail:m,handleUsernameChange:t,handlePasswordChange:T,handleEmailChange:E,setShowDeleteModal:I,usernameLoading:A,passwordLoading:L,emailLoading:D,t:b})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:b("settings.profile")}),e.jsx("button",{onClick:()=>_(!0),className:"px-4 py-2 bg-theme-blue text-white rounded-md hover:bg-blue-600",children:b("settings.updateProfile")})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-theme-text-primary dark:text-theme-dark-text",children:b("settings.language")}),e.jsx("div",{className:"flex space-x-2",children:["ENG","JAP","VIE"].map(u=>e.jsx("button",{onClick:()=>x(u),className:`px-4 py-2 rounded-md ${i===u?"bg-theme-blue text-white":"bg-gray-200 dark:bg-theme-dark-bg text-gray-700 dark:text-theme-dark-text hover:bg-gray-300 dark:hover:bg-theme-dark-hover"}`,children:u},u))})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-theme-text-primary dark:text-theme-dark-text",children:b("settings.username")}),F?e.jsxs("form",{onSubmit:u=>{u.preventDefault(),t()},className:"space-y-2",children:[e.jsx("input",{type:"text",placeholder:b("settings.newUsername"),value:N,onChange:u=>l(u.target.value),autoComplete:"username",maxLength:15,minLength:4,pattern:"^[a-zA-Z][a-zA-Z0-9_]*$",title:"Username must start with a letter and contain only letters, numbers, and underscores",className:"w-full p-2 border rounded-md bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80"}),e.jsx("input",{type:"password",placeholder:b("settings.currentPassword"),value:p,onChange:u=>k(u.target.value),autoComplete:"current-password",className:"w-full p-2 border rounded-md bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"submit",disabled:A,className:`px-4 py-2 text-white rounded-md transition-colors duration-200 ${A?"bg-gray-400 cursor-not-allowed":"bg-theme-blue hover:bg-blue-600 dark:hover:bg-theme-blue-coral"}`,children:b(A?"common.loading":"settings.update")}),e.jsx("button",{type:"button",disabled:A,onClick:()=>{M(!1),l(""),k("")},className:`px-4 py-2 text-white rounded-md transition-colors duration-200 ${A?"bg-gray-400 cursor-not-allowed":"bg-gray-500 hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700"}`,children:b("common.cancel")})]})]}):e.jsx("button",{onClick:()=>M(!0),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700",children:b("settings.changeUsername")})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-theme-text-primary dark:text-theme-dark-text",children:b("settings.password")}),C?e.jsxs("form",{onSubmit:u=>{u.preventDefault(),T()},className:"space-y-2",children:[e.jsx("input",{type:"password",placeholder:b("settings.currentPassword"),value:p,onChange:u=>k(u.target.value),autoComplete:"current-password",className:"w-full p-2 border rounded-md bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80"}),e.jsx("input",{type:"password",placeholder:b("settings.newPassword"),value:y,onChange:u=>g(u.target.value),autoComplete:"new-password",className:"w-full p-2 border rounded-md bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80"}),e.jsx("input",{type:"password",placeholder:b("settings.confirmPassword"),value:U,onChange:u=>d(u.target.value),autoComplete:"new-password",className:"w-full p-2 border rounded-md bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"submit",disabled:L,className:`px-4 py-2 text-white rounded-md transition-colors duration-200 ${L?"bg-gray-400 cursor-not-allowed":"bg-theme-blue hover:bg-blue-600 dark:hover:bg-theme-blue-coral"}`,children:b(L?"common.loading":"settings.update")}),e.jsx("button",{type:"button",disabled:L,onClick:()=>{h(!1),g(""),d(""),k("")},className:`px-4 py-2 text-white rounded-md transition-colors duration-200 ${L?"bg-gray-400 cursor-not-allowed":"bg-gray-500 hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700"}`,children:b("common.cancel")})]})]}):e.jsx("button",{onClick:()=>h(!0),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700",children:b("settings.changePassword")})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-theme-text-primary dark:text-theme-dark-text",children:b("settings.email")}),f?e.jsxs("form",{onSubmit:u=>{u.preventDefault(),E()},className:"space-y-2",children:[e.jsx("input",{type:"email",name:"email",id:"email",autoComplete:"email",placeholder:b("settings.newEmail"),value:a,onChange:u=>v(u.target.value),className:"w-full p-2 border rounded-md bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80"}),e.jsx("input",{type:"password",placeholder:b("settings.currentPassword"),value:p,onChange:u=>k(u.target.value),autoComplete:"current-password",className:"w-full p-2 border rounded-md bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{type:"submit",disabled:D,className:`px-4 py-2 text-white rounded-md transition-colors duration-200 ${D?"bg-gray-400 cursor-not-allowed":"bg-theme-blue hover:bg-blue-600 dark:hover:bg-theme-blue-coral"}`,children:b(D?"common.loading":"settings.update")}),e.jsx("button",{type:"button",disabled:D,onClick:()=>{m(!1),v(""),k("")},className:`px-4 py-2 text-white rounded-md transition-colors duration-200 ${D?"bg-gray-400 cursor-not-allowed":"bg-gray-500 hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700"}`,children:b("common.cancel")})]})]}):e.jsx("button",{onClick:()=>m(!0),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700",children:b("settings.changeEmail")})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-red-600 dark:text-red-400",children:b("settings.dangerZone")}),e.jsx("button",{onClick:()=>I(!0),className:"px-4 py-2 !bg-red-600 !text-white rounded-md hover:!bg-red-700 dark:!bg-red-600 dark:hover:!bg-red-700",children:b("settings.deleteAccount")})]})]}),Re=({translationStats:s,loadingStats:i,translationHistory:x,loadingHistory:r,selectedDate:_,setSelectedDate:N,showHistory:l,setShowHistory:y,fetchTranslationHistory:g,fetchTranslationStats:U,t:d})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-theme-text-primary dark:text-theme-dark-text",children:d("translation.translationUsage")}),i?e.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[d("common.loading"),"..."]}):s?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-blue-800 dark:text-blue-200 font-medium",children:[d("translation.monthlyLimit"),":"]}),e.jsx("span",{className:"text-blue-700 dark:text-blue-300 ml-2",children:s.limit===-1?d("translation.translationUsageUnlimited"):s.limit})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-blue-800 dark:text-blue-200 font-medium",children:[d("translation.translationsUsed"),":"]}),e.jsx("span",{className:"text-blue-700 dark:text-blue-300 ml-2",children:s.used})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-blue-800 dark:text-blue-200 font-medium",children:[d("translation.translationsRemaining"),":"]}),e.jsx("span",{className:"text-blue-700 dark:text-blue-300 ml-2",children:s.remaining===-1?d("translation.translationUsageUnlimited"):s.remaining})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-800 dark:text-blue-200 font-medium",children:d("translation.translationUsageRole")}),e.jsx("span",{className:"text-blue-700 dark:text-blue-300 ml-2",children:s.role==="vip"?d("translation.translationUsageVIP"):s.role==="admin"?d("translation.translationUsageAdmin"):s.role==="mod"?d("translation.translationUsageMod"):s.role==="support"?d("translation.translationUsageSupport"):d("translation.translationUsageMember")})]})]}),s.limit!==-1&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-blue-600 dark:text-blue-400 mb-1",children:[e.jsx("span",{children:d("translation.translationUsageDescription",{used:s.used,limit:s.limit})}),e.jsxs("span",{children:[Math.round(s.used/s.limit*100),"%"]})]}),e.jsx("div",{className:"w-full bg-blue-200 dark:bg-blue-800 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 dark:bg-blue-400 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(s.used/s.limit*100,100)}%`}})})]}),e.jsx("div",{className:"mt-3 text-xs text-blue-600 dark:text-blue-400",children:d("translation.translationUsageReset")})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-md font-semibold text-blue-800 dark:text-blue-200",children:d("translation.translationHistory")}),e.jsx("button",{onClick:()=>{y(!l),l||g()},className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium",children:d(l?"translation.hideHistory":"translation.showHistory")})]}),l&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[d("translation.selectDate"),":"]}),e.jsx("input",{type:"date",value:_,onChange:a=>{N(a.target.value),g(a.target.value)},className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"})]}),r?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:[d("common.loading"),"..."]})]}):x&&Array.isArray(x)&&x.length>0?e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:(x||[]).map((a,v)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded",children:a.post_id?d("translation.post"):d("translation.comment")}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(a.translated_at).toLocaleTimeString()})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[a.source_language," â†’ ",a.target_language]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:[d("translation.originalText"),":"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-700 p-2 rounded",children:(a.original_text||"").length>200?`${a.original_text.substring(0,200)}...`:a.original_text})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:[d("translation.translatedText"),":"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 bg-green-50 dark:bg-green-900/20 p-2 rounded",children:(a.translated_text||"").length>200?`${a.translated_text.substring(0,200)}...`:a.translated_text})]})]})]},a.id||v))}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:d("translation.noHistoryForDate")})})]})]})]}):e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:d("translation.translationServiceUnavailable")})]})}),Ie=({user:s,t:i,showThemeEditor:x,setShowThemeEditor:r,translationStats:_})=>{const N=ie(),[l,y]=n.useState(null),[g,U]=n.useState(null),[d,a]=n.useState(!0),[v,p]=n.useState(!1),[k,F]=n.useState(!1);n.useEffect(()=>{(async()=>{a(!0);try{const t=(await $.get("/api/subscriptions/user/settings-data")).data;y({current_tier:t.current_tier,subscriptions:t.subscriptions,user_subscription_types:t.user_subscription_types}),U(t.theme_slots)}catch{try{const[t,T]=await Promise.all([$.get("/api/subscriptions/user/tier-status").catch(E=>$.get("/api/subscriptions/plans")),$.get("/api/subscriptions/themes/slots")]);y(t.data),U(T.data)}catch{}}finally{a(!1)}})()},[]);const M=()=>{var T;const f=(T=l==null?void 0:l.subscriptions)==null?void 0:T.some(E=>E.status==="active"||E.status==="pending"),m=l==null?void 0:l.current_tier;if(f||m&&m!=="free"){let E=m;if(f&&!m){const I=(l==null?void 0:l.user_subscription_types)||[];I.includes("vip")?E="vip":I.includes("support")&&(E="support")}if(E==="support")return{tier:"support",name:"Support",description:"Support tier with enhanced features",daysRemaining:29,benefits:["Create up to 10 subthreads","Custom theme support","SUPPORT badge","Priority support","Enhanced file upload limits","Increased translation limits"]};if(E==="vip")return{tier:"vip",name:"VIP",description:"VIP tier with unlimited features",daysRemaining:29,benefits:["Unlimited subthreads","Custom theme support","VIP badge","Priority support","Unlimited file uploads","Unlimited translations"]}}return(s==null?void 0:s.username)==="kanw"?{tier:"support",name:"Support",description:"Support tier with enhanced features",daysRemaining:29,benefits:["Create up to 10 subthreads","Custom theme support","SUPPORT badge","Priority support","Enhanced file upload limits","Increased translation limits"]}:{tier:"free",name:"Free",description:"Basic user tier with limited features",daysRemaining:null,benefits:["Create up to 3 subthreads","Basic theme support","10MB file upload limit",`${(_==null?void 0:_.limit)||100} translations per month`]}},C=async()=>{var f,m;try{if(p(!0),(await $.post("/api/subscriptions/cancel")).data.success){w.success(i("subscription.cancellationSuccess")),F(!1);const T=await $.get("/api/subscriptions/user/tier-status");y(T.data)}}catch(t){w.error(((m=(f=t.response)==null?void 0:f.data)==null?void 0:m.error)||i("subscription.cancellationError"))}finally{p(!1)}},h=l?M():{tier:"loading",name:"Loading...",description:"Loading subscription data...",daysRemaining:null,benefits:[]};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-theme-text-primary dark:text-theme-dark-text",children:i("subscription.subscriptions")}),d||!l?e.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[i("common.loading"),"..."]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200",children:i("subscription.currentSubscription")}),d?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-theme-blue"}),e.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading subscription data..."})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("h5",{className:"text-lg font-semibold text-blue-800 dark:text-blue-200",children:h.name})}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-300 mb-3",children:h.description}),e.jsx("div",{className:"space-y-2",children:h.benefits.map((f,m)=>e.jsxs("div",{className:"flex items-center text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),f]},m))}),h.tier!=="free"&&h.daysRemaining!==null&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-green-600 dark:text-green-400 mb-1",children:[e.jsxs("span",{children:["Subscription expires in ",h.daysRemaining," days"]}),e.jsxs("span",{children:[Math.max(0,Math.round(h.daysRemaining/30*100)),"% remaining"]})]}),e.jsx("div",{className:"w-full bg-green-200 dark:bg-green-800 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 dark:bg-green-400 h-2 rounded-full transition-all duration-300",style:{width:`${Math.max(0,Math.min(h.daysRemaining/30*100,100))}%`}})})]}),h.tier!=="free"&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["Your subscription is active and you have access to all ",h.name," features."]})]})})]}),g&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-purple-800 dark:text-purple-200 font-semibold mb-3",children:[i("subscription.currentLimits"),":"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 border border-purple-200 dark:border-purple-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:i("subscription.themeSlots")}),e.jsxs("span",{className:"text-xs text-purple-600 dark:text-purple-400",children:[g.used_slots,"/",g.total_slots]})]}),e.jsx("div",{className:"w-full bg-purple-200 dark:bg-purple-800 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 dark:bg-purple-400 h-2 rounded-full transition-all duration-300",style:{width:`${g.total_slots>0?g.used_slots/g.total_slots*100:0}%`}})}),e.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-400 mt-1",children:g.available_slots>0?i("subscription.availableSlots",{count:g.available_slots}):i("subscription.noSlotsAvailable")})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 border border-purple-200 dark:border-purple-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:i("subscription.subthreadLimit")})}),e.jsx("div",{className:"text-lg font-semibold text-purple-800 dark:text-purple-200",children:h.tier==="vip"?i("subscription.unlimited"):h.tier==="support"?"10":"3"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 border border-purple-200 dark:border-purple-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:i("subscription.uploadLimit")})}),e.jsx("div",{className:"text-lg font-semibold text-purple-800 dark:text-purple-200",children:h.tier==="vip"?"100MB":h.tier==="support"?"50MB":"10MB"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 border border-purple-200 dark:border-purple-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:i("subscription.translationLimit")})}),e.jsx("div",{className:"text-lg font-semibold text-purple-800 dark:text-purple-200",children:h.tier==="vip"?i("subscription.unlimited"):h.tier==="support"?`${(_==null?void 0:_.limit)||500}/month`:`${(_==null?void 0:_.limit)||100}/month`})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200",children:i("themes.customThemes")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:i("themes.createAndManageThemes")}),d||h.tier==="loading"?e.jsxs("div",{className:"flex items-center justify-center py-6",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-theme-blue"}),e.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading theme data..."})]}):h.tier==="free"?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-gray-400 dark:text-gray-500 text-4xl mb-3",children:"ðŸŽ¨"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:i("themes.upgradeToAccessThemes")}),e.jsx("button",{onClick:()=>N("/subscriptions"),className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-6 py-2 rounded-md transition-colors",children:i("subscription.buySubscription")})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex space-x-3",children:[g&&g.available_slots>0&&e.jsx("button",{onClick:()=>r(!0),className:"bg-theme-success hover:bg-theme-success-light text-white px-4 py-2 rounded-md transition-colors text-sm",children:i("themes.createNewTheme")}),g&&g.used_slots>0&&e.jsx("button",{onClick:()=>r(!0),className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-4 py-2 rounded-md transition-colors text-sm",children:i("themes.viewThemes")})]}),g&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[i("themes.themeSlots"),": ",g.used_slots,"/",g.total_slots]}),e.jsx("span",{className:`text-xs font-medium ${g.available_slots>0?"text-theme-success":"text-theme-warning"}`,children:g.available_slots>0?i("themes.availableSlots",{count:g.available_slots}):i("themes.noSlotsAvailable")})]})})]})]}),x&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:i("themes.customThemes")}),e.jsx("button",{onClick:()=>r(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx(Me,{disableModal:!0,onThemeCreated:()=>r(!1),themeSlotsData:g})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>N("/subscriptions"),className:"px-4 py-2 bg-theme-blue text-white rounded-md hover:bg-theme-blue-coral transition-colors",children:h.tier==="free"?i("subscription.buySubscription"):i("subscription.manageSubscription")}),h.tier!=="free"&&e.jsx("button",{onClick:()=>F(!0),className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:i("subscription.cancelSubscription")})]}),k&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"âš ï¸"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:i("subscription.cancelSubscriptionTitle")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:i("subscription.cancelSubscriptionWarning")}),e.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm mb-6",children:i("subscription.cancelSubscriptionImportant")}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:C,disabled:v,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:i(v?"common.loading":"subscription.confirmCancel")}),e.jsx("button",{onClick:()=>F(!1),disabled:v,className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:i("common.cancel")})]})]})})})]})]})})},Oe=({t:s})=>{const[i,x]=n.useState([]),[r,_]=n.useState(!1),[N,l]=n.useState("all"),[y,g]=n.useState("all"),[U,d]=n.useState("newest"),[a,v]=n.useState(new Set);$e(),n.useEffect(()=>{p()},[]),n.useEffect(()=>{const t=T=>{const{type:E,purchaseType:I,purchaseData:A,purchaseId:L,newStatus:D}=T.detail;E==="new_purchase"?x(b=>{const u={...A,id:A.id||`new_${Date.now()}`,created_at:A.created_at||new Date().toISOString()};return b.some(Q=>Q.id===u.id)?b:(v(Q=>new Set([...Q,u.id])),setTimeout(()=>{v(Q=>{const Z=new Set(Q);return Z.delete(u.id),Z})},5e3),[u,...b])}):E==="status_update"&&x(b=>b.map(u=>u.id===L||u.id===`sub_${L}`||u.id===`coin_${L}`||u.id===`avatar_${L}`||u.id===`boost_${L}`||u.id===`tier_${L}`?{...u,payment_status:D,is_active:D==="completed"||D==="active"}:u))};return window.addEventListener("purchaseHistoryUpdated",t),()=>{window.removeEventListener("purchaseHistoryUpdated",t)}},[]);const p=async()=>{_(!0);try{const t=await $.get("/api/subscriptions/purchase-history");t.data.success&&x(t.data.purchase_history)}catch{w.error(s("settings.failedToLoadPurchaseHistory"))}finally{_(!1)}},k=t=>{switch(t){case"completed":case"active":return"text-green-600 dark:text-green-400";case"pending":return"text-yellow-600 dark:text-yellow-400";case"failed":case"cancelled":case"expired":return"text-red-600 dark:text-red-400";default:return"text-gray-600 dark:text-gray-400"}},F=t=>{if(t.expires_at){const T=new Date,E=new Date(t.expires_at);if(T>E&&t.payment_status==="pending")return"expired"}return t.payment_status||(t.is_active?"active":"inactive")},M=t=>t==="momo"?"bank":t,C=t=>t?new Date(t).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",h=(t,T="VND")=>t==null?"N/A":new Intl.NumberFormat("vi-VN",{style:"currency",currency:T}).format(t),m=[...i.filter(t=>{const T=N==="all"||t.type===N,E=F(t),I=y==="all"||E===y||t.is_active===(y==="active");return T&&I})].sort((t,T)=>{const E=new Date(t.created_at||0),I=new Date(T.created_at||0);return U==="newest"?I-E:E-I});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:s("settings.purchaseHistory")}),e.jsx("p",{className:"text-theme-text-secondary dark:text-theme-dark-text-secondary",children:s("settings.purchaseHistoryDescription")})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-text-primary dark:text-theme-dark-text mb-1",children:s("settings.filterByType")}),e.jsxs("select",{value:N,onChange:t=>l(t.target.value),className:"px-3 py-2 border border-theme-border-light dark:border-theme-dark-border rounded-md bg-theme-bg-primary dark:bg-theme-dark-bg text-theme-text-primary dark:text-theme-dark-text",children:[e.jsx("option",{value:"all",children:s("settings.allTypes")}),e.jsx("option",{value:"subscription",children:s("settings.subscription")}),e.jsx("option",{value:"coin_purchase",children:s("settings.coinPurchase")}),e.jsx("option",{value:"avatar_purchase",children:s("settings.avatarPurchase")}),e.jsx("option",{value:"post_boost",children:s("settings.postBoost")}),e.jsx("option",{value:"tier_purchase",children:s("settings.tierPurchase")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-text-primary dark:text-theme-dark-text mb-1",children:s("settings.filterByStatus")}),e.jsxs("select",{value:y,onChange:t=>g(t.target.value),className:"px-3 py-2 border border-theme-border-light dark:border-theme-dark-border rounded-md bg-theme-bg-primary dark:bg-theme-dark-bg text-theme-text-primary dark:text-theme-dark-text",children:[e.jsx("option",{value:"all",children:s("settings.allStatuses")}),e.jsx("option",{value:"completed",children:s("settings.completed")}),e.jsx("option",{value:"pending",children:s("settings.pending")}),e.jsx("option",{value:"failed",children:s("settings.failed")}),e.jsx("option",{value:"cancelled",children:s("settings.cancelled")}),e.jsx("option",{value:"active",children:s("settings.active")}),e.jsx("option",{value:"expired",children:s("settings.expired")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-text-primary dark:text-theme-dark-text mb-1",children:s("settings.sortByDate")}),e.jsxs("select",{value:U,onChange:t=>d(t.target.value),className:"px-3 py-2 border border-theme-border-light dark:border-theme-dark-border rounded-md bg-theme-bg-primary dark:bg-theme-dark-bg text-theme-text-primary dark:text-theme-dark-text",children:[e.jsx("option",{value:"newest",children:s("settings.newestFirst")}),e.jsx("option",{value:"oldest",children:s("settings.oldestFirst")})]})]})]}),r?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-theme-blue"}),e.jsxs("p",{className:"mt-2 text-sm text-theme-text-secondary dark:text-theme-dark-text-secondary",children:[s("settings.loading"),"..."]})]}):m&&Array.isArray(m)&&m.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("p",{className:"text-sm text-theme-text-secondary dark:text-theme-dark-text-secondary",children:[s("settings.totalPurchases"),": ",(m==null?void 0:m.length)||0]})}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:(m||[]).map(t=>e.jsx("div",{className:`bg-theme-bg-primary dark:bg-theme-dark-bg border border-theme-border-light dark:border-theme-dark-border rounded-lg p-4 transition-all duration-300 ${a.has(t.id)?"ring-2 ring-green-400 shadow-lg animate-pulse":""}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-theme-text-primary dark:text-theme-dark-text",children:t.description||t.type}),a.has(t.id)&&e.jsx("span",{className:"text-xs px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full animate-pulse",children:s("settings.new")}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${k(F(t))}`,children:F(t)})]}),e.jsxs("div",{className:"text-sm text-theme-text-secondary dark:text-theme-dark-text-secondary space-y-1",children:[e.jsxs("p",{children:[s("settings.purchaseDate"),": ",C(t.created_at)]}),t.amount&&e.jsxs("p",{children:[s("settings.purchaseAmount"),": ",h(t.amount,t.currency)]}),t.coin_amount&&e.jsxs("p",{children:[s("settings.coinAmount"),": ",t.coin_amount," ",s("coins.coins")]}),t.tier_name&&e.jsxs("p",{children:[s("settings.tierName"),": ",t.tier_name]}),t.avatar_name&&e.jsxs("p",{children:[s("settings.avatarName"),": ",t.avatar_name]}),t.post_id&&e.jsxs("p",{children:[s("settings.postId"),": #",t.post_id]}),t.payment_method&&e.jsxs("p",{children:[s("settings.paymentMethod"),": ",M(t.payment_method)]}),t.balance_after&&e.jsxs("p",{children:[s("settings.balanceAfter"),": ",t.balance_after," ",s("coins.coins")]})]})]})})},t.id))})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h3",{className:"text-lg font-medium text-theme-text-primary dark:text-theme-dark-text mb-2",children:s("settings.noPurchases")}),e.jsx("p",{className:"text-theme-text-secondary dark:text-theme-dark-text-secondary",children:s("settings.noPurchasesDescription")})]})]})};function Ve(){const s=ie(),i=ae(),{user:x,customTheme:r,setCustomTheme:_,updateUserData:N}=se(),{t:l,i18n:y}=le(),{translationStats:g,loadingStats:U,fetchTranslationStats:d}=Le(),[a,v]=n.useState("general"),[p,k]=n.useState(!1),[F,M]=n.useState(()=>({en:"ENG",ja:"JAP",vi:"VIE"})[y.language]||"ENG"),[C,h]=n.useState(""),[f,m]=n.useState(""),[t,T]=n.useState(""),[E,I]=n.useState(""),[A,L]=n.useState(""),[D,b]=n.useState(""),[u,W]=n.useState(!1),[Q,Z]=n.useState(!1),[X,c]=n.useState(!1),[B,V]=n.useState(!1),[Y,ee]=n.useState(!1),[J,G]=n.useState(!1),[te,re]=n.useState([]),[de,o]=n.useState(!1),[S,j]=n.useState(new Date().toISOString().split("T")[0]),[K,ve]=n.useState(!1),[ke,je]=n.useState(!1),[oe,ce]=n.useState(!1),[me,he]=n.useState(!1),[ue,xe]=n.useState(!1);n.useEffect(()=>{const O=new URLSearchParams(window.location.search).get("tab");O&&["general","translation","themes","subscription"].includes(O)&&v(O)},[]),n.useEffect(()=>(document.title=`${l("settings.settings")} - YuuZone`,()=>document.title="YuuZone"),[l]),n.useEffect(()=>{x&&a==="translation"&&!g&&d()},[x,a,g,d]);const we=async(P=S)=>{o(!0);try{const O=await $.get(`/api/translate/history?date=${P}`);re(O.data.history)}catch{w.error(l("translation.failedToLoadHistory"))}finally{o(!1)}},Ne=async P=>{M(P);const q={ENG:"en",JAP:"ja",VIE:"vi"}[P]||"en";if(y.changeLanguage(q),localStorage.setItem("yuuzone_language",q),x)try{await $.patch("/api/user/language",{language:q})}catch{}},_e=async()=>{var O,q;const P=`sudo rm ${x.username}`;if(C!==P){w.error(l("settings.pleaseTypeExactly",{text:P}));return}ee(!0),G(!0);try{await $.post("/api/user/request-deletion"),V(!1),h(""),w.success(l("settings.deletionVerificationSent")),setTimeout(()=>{s("/login")},2e3)}catch(R){const z=((q=(O=R.response)==null?void 0:O.data)==null?void 0:q.user_message)||l("settings.failedToDeleteAccount");w.error(z),ee(!1),G(!1)}},Ce=async()=>{var O,q,R;if(!f.trim()){w.error(l("settings.pleaseEnterNewUsername"));return}const P=f.trim();if(P.length<4||P.length>15){w.error(l("settings.usernameLengthError",{min:4,max:15}));return}if(!/^[a-zA-Z][a-zA-Z0-9_]*$/.test(P)){w.error(l("settings.usernameFormatError"));return}if(P.startsWith("del_")){w.error(l("settings.usernameReservedPrefixError"));return}if(!oe){ce(!0);try{const z=new FormData;z.append("username",P),z.append("current_password",D),console.log("Sending username update request:",{username:P,hasPassword:!!D});const ne=await $.patch("/api/user/username",z);console.log("Username update response:",ne.data),i.setQueryData(["user"],()=>ne.data),x&&N&&N(ne.data),W(!1),m(""),b(""),w.success(l("settings.usernameUpdatedSuccessfully"))}catch(z){console.error("Username update error:",((O=z.response)==null?void 0:O.data)||z.message),w.error(((R=(q=z.response)==null?void 0:q.data)==null?void 0:R.message)||l("settings.failedToUpdateUsername"))}finally{ce(!1)}}},Se=async()=>{var P,O,q;if(!t||!E){w.error(l("settings.pleaseFillAllPasswordFields"));return}if(t!==E){w.error(l("settings.passwordsDoNotMatch"));return}if(!me){he(!0);try{const R=new FormData;R.append("new_password",t),R.append("current_password",D),console.log("Sending password update request:",{hasNewPassword:!!t,hasCurrentPassword:!!D});const z=await $.patch("/api/user/password",R);console.log("Password update response:",z.data),Z(!1),T(""),I(""),b(""),w.success(l("settings.passwordUpdatedSuccessfully"))}catch(R){console.error("Password update error:",((P=R.response)==null?void 0:P.data)||R.message),w.error(((q=(O=R.response)==null?void 0:O.data)==null?void 0:q.message)||l("settings.failedToUpdatePassword"))}finally{he(!1)}}},Te=async()=>{var P,O,q;if(!A.trim()){w.error(l("settings.pleaseEnterNewEmail"));return}if(!ue){xe(!0);try{const R=new FormData;R.append("email",A),R.append("current_password",D),console.log("Sending email update request:",{email:A,hasPassword:!!D});const z=await $.patch("/api/user/email",R);console.log("Email update response:",z.data),i.setQueryData(["user"],()=>z.data),x&&N&&N(z.data),c(!1),L(""),b(""),w.success(l("settings.emailUpdatedSuccessfully"))}catch(R){console.error("Email update error:",((P=R.response)==null?void 0:P.data)||R.message),w.error(((q=(O=R.response)==null?void 0:O.data)==null?void 0:q.message)||l("settings.failedToUpdateEmail"))}finally{xe(!1)}}},Pe=[{id:"general",label:l("settings.generalSettings")},{id:"translation",label:l("translation.translationUsage")},{id:"subscription",label:l("subscription.subscriptions")},{id:"purchase-history",label:l("settings.purchaseHistory")}];return e.jsxs("div",{className:"flex flex-col flex-1 items-center w-full bg-theme-light-gray2 dark:bg-theme-dark-bg dark:text-theme-dark-text p-4",children:[e.jsxs("div",{className:"w-full max-w-4xl bg-theme-less-white dark:bg-theme-dark-card dark:text-theme-dark-text border border-theme-border-light dark:border-theme-dark-border rounded-md p-6 shadow-md",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center text-theme-text-primary dark:text-theme-dark-text",children:l("settings.settings")}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-theme-light-gray2 dark:bg-theme-dark-bg rounded-md mb-6",children:[e.jsx("img",{src:x.avatar||ye,alt:l("settings.userAvatar"),className:"w-16 h-16 rounded-md object-cover"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-theme-text-primary dark:text-theme-dark-text",children:x.username}),e.jsxs("p",{className:"text-theme-text-secondary dark:text-theme-dark-text",children:[l("settings.karma"),": ",x.karma.user_karma]})]})]}),e.jsx("div",{className:"flex space-x-1 mb-6 bg-gray-100 dark:bg-gray-800 rounded-lg p-1",children:Pe.map(P=>e.jsxs("button",{onClick:()=>v(P.id),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 rounded-md text-sm font-medium transition-colors ${a===P.id?"bg-white dark:bg-gray-700 text-theme-blue shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200"}`,children:[e.jsx("span",{children:P.icon}),e.jsx("span",{children:P.label})]},P.id))}),e.jsxs("div",{className:"min-h-[400px]",children:[a==="general"&&e.jsx(Fe,{user:x,language:F,handleLanguageChange:Ne,showUpdateProfile:p,setShowUpdateProfile:k,newUsername:f,setNewUsername:m,newPassword:t,setNewPassword:T,confirmPassword:E,setConfirmPassword:I,newEmail:A,setNewEmail:L,currentPassword:D,setCurrentPassword:b,showChangeUsername:u,setShowChangeUsername:W,showChangePassword:Q,setShowChangePassword:Z,showChangeEmail:X,setShowChangeEmail:c,handleUsernameChange:Ce,handlePasswordChange:Se,handleEmailChange:Te,setShowDeleteModal:V,usernameLoading:oe,passwordLoading:me,emailLoading:ue,t:l}),a==="translation"&&e.jsx(Re,{translationStats:g,loadingStats:U,translationHistory:te,loadingHistory:de,selectedDate:S,setSelectedDate:j,showHistory:K,setShowHistory:ve,fetchTranslationHistory:we,fetchTranslationStats:()=>{},t:l}),a==="subscription"&&e.jsx(Ie,{user:x,t:l,showThemeEditor:ke,setShowThemeEditor:je,translationStats:g}),a==="purchase-history"&&e.jsx(Oe,{t:l})]})]}),B&&e.jsx(be,{setShowModal:V,children:e.jsxs("div",{className:"bg-theme-less-white dark:bg-theme-dark-card p-6 rounded-md shadow-md w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600 dark:text-red-400 mb-4 text-center",children:l("settings.deleteAccount")}),e.jsx("p",{className:"mb-2 text-gray-700 dark:text-gray-300 text-center",children:l("settings.deleteAccountConfirm")}),e.jsx("p",{className:"mb-2 text-gray-700 dark:text-gray-300 text-center",children:l("settings.deleteConfirmation",{username:x.username})}),e.jsx("input",{type:"text",placeholder:`sudo rm ${x.username}`,value:C,onChange:P=>h(P.target.value),className:"w-full p-2 border rounded-md bg-theme-light-gray2 dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80 mt-2 mb-4",disabled:J}),e.jsxs("div",{className:"flex space-x-2 justify-center",children:[e.jsx("button",{onClick:_e,className:"px-4 py-2 !bg-red-600 !text-white rounded-md hover:!bg-red-700 dark:!bg-red-600 dark:hover:!bg-red-700 disabled:opacity-50",disabled:J||Y,children:l(Y?"common.loading":"settings.deleteAccount")}),e.jsx("button",{onClick:()=>V(!1),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700",disabled:J,children:l("common.cancel")})]})]})}),p&&e.jsx(be,{showModal:p,setShowModal:k,children:e.jsx(fe,{setModal:k})})]})}export{Ve as default};
