import{a as $,j as e,B as S,E as U,V as J,c as K,A as X,r as c,Q as d,M as Y}from"./vendor_react_core-BQ601SDD.js";import{a as w}from"./vendor_axios-NIGUFBhG.js";import"./vendor_other-CYhXLBgr.js";import"./vendor_socket_io_client-BJzX-5m1.js";const Z=({type:s,name:f,price:B,description:a,benefits:_,isOwned:C,expiresIn:m,onBuyClick:h,image:x,isCurrentTier:y})=>{const{t:o}=$();return e.jsxs(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-theme-bg-primary dark:bg-theme-dark-card rounded-2xl shadow-lg p-6 flex flex-col items-center text-center max-w-sm mx-auto",children:[e.jsx("div",{className:"mb-4 flex items-center justify-center",children:s==="support"?e.jsx(U,{className:"px-6 py-2 text-lg font-bold rounded-lg"}):s==="vip"?e.jsx(J,{className:"px-6 py-2 text-lg font-bold rounded-lg"}):null}),e.jsx("h3",{className:"text-xl font-bold text-theme-text-primary dark:text-theme-dark-text mb-2",children:f}),e.jsx("p",{className:"text-theme-text-secondary dark:text-theme-dark-text-secondary text-sm mb-4 leading-relaxed",children:s==="free"?o("subscription.freeDescription"):s==="support"?o("subscription.supportDescription"):s==="vip"?o("subscription.vipDescription"):a}),e.jsx("div",{className:"w-full mb-6",children:e.jsx("ul",{className:"text-left space-y-2",children:(s==="free"?o("subscription.freeBenefits",{returnObjects:!0}):s==="support"?o("subscription.supportBenefits",{returnObjects:!0}):s==="vip"?o("subscription.vipBenefits",{returnObjects:!0}):_).map((i,E)=>e.jsxs("li",{className:"flex items-start text-sm text-theme-text-primary dark:text-theme-dark-text",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500 mr-2 mt-0.5 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),i]},E))})}),e.jsx("div",{className:"text-2xl font-bold text-theme-blue mb-4",children:B}),y?e.jsx("div",{className:"w-full",children:e.jsx("div",{className:"bg-theme-bg-tertiary dark:bg-theme-dark-bg-secondary text-theme-text-secondary dark:text-theme-dark-text-secondary px-4 py-2 rounded-lg text-sm font-medium",children:o("subscription.youAreHere")})}):C?e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 px-4 py-2 rounded-lg text-sm font-medium flex items-center justify-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-2",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),o("subscription.alreadyOwned")]}),m!==null&&e.jsx("div",{className:"text-xs text-theme-text-muted dark:text-theme-dark-text-secondary mt-2 text-center",children:m>0?e.jsx("span",{className:"text-green-600 dark:text-green-400",children:o("subscription.expiresIn",{days:m})}):e.jsx("span",{className:"text-red-600 dark:text-red-400",children:o("subscription.expired")})}),e.jsx("div",{className:"text-xs text-theme-text-muted dark:text-theme-dark-text-secondary mt-1 text-center",children:o("subscription.noNeedToBuyAgain")})]}):e.jsx("button",{onClick:()=>h(s),className:"w-full bg-theme-button-primary hover:bg-theme-button-primary-hover text-white font-medium py-3 px-6 rounded-lg transition-colors duration-200 transform hover:scale-105",children:o("subscription.buyNow")})]})},re=()=>{var O;const{t:s}=$(),f=K(),{socket:B}=X(),[a,_]=c.useState(null),[C,m]=c.useState(!0),[h,x]=c.useState(!1),[y,o]=c.useState(null),[i,E]=c.useState(null),[g,Q]=c.useState([]),[j,L]=c.useState(!1),[b,k]=c.useState(300),[v,u]=c.useState(!1),[T,M]=c.useState(!1),p=c.useRef(null);c.useEffect(()=>{A(),N()},[]),c.useEffect(()=>(v&&b>0&&(p.current=setInterval(()=>{k(t=>t<=1?(u(!1),d.error(s("subscription.paymentExpired")),x(!1),N(),0):t-1)},1e3)),()=>{p.current&&clearInterval(p.current)}),[v,b,s]),c.useEffect(()=>{let t;return v&&(i!=null&&i.payment_reference)&&b>0&&!T&&(t=setInterval(()=>{P(i.payment_reference,!0)},3e4)),()=>{t&&clearInterval(t)}},[v,i==null?void 0:i.payment_reference,b,T]),c.useEffect(()=>{const t=r=>{const{payment_reference:n,payment_type:l,amount:R,tier_name:W}=r.detail;l==="subscription"&&(M(!0),d.success(`${s("subscription.paymentCompleted")} - ${W||"Subscription"}`),x(!1),u(!1),f(`/payment-success/${n}`))};return window.addEventListener("paymentCompleted",t),()=>{window.removeEventListener("paymentCompleted",t)}},[f,s]),c.useEffect(()=>{h||(u(!1),k(300),p.current&&clearInterval(p.current))},[h]);const V=t=>{const r=Math.floor(t/60),n=t%60;return`${r.toString().padStart(2,"0")}:${n.toString().padStart(2,"0")}`},A=async()=>{try{const t=await w.get("/api/subscriptions/plans");_(t.data)}catch(t){console.error(s("subscription.consoleErrorFetchingSubscriptionData"),t),d.error(s("subscription.toastErrorFailedToLoadSubscriptionData"))}finally{m(!1)}},N=async()=>{try{const t=await w.get("/api/subscriptions/payment/pending");Q(t.data.pending_payments||[])}catch(t){console.error("Error fetching pending payments:",t)}},z=async t=>{var r,n;try{o(t),m(!0);const l=await w.get(`/api/subscriptions/payment/qr/${t}`);E(l.data),x(!0),k(300),u(!0),M(!1),await N()}catch(l){console.error(s("subscription.consoleErrorGeneratingPaymentQR"),l),(n=(r=l.response)==null?void 0:r.data)!=null&&n.error?d.error(l.response.data.error):d.error(s("subscription.toastErrorFailedToGeneratePaymentQR"))}finally{m(!1)}},P=async(t,r=!1)=>{try{L(!0);const n=await w.get(`/api/subscriptions/payment/status/${t}`);n.data.status==="completed"?(r||d.success(s("subscription.paymentCompleted")),x(!1),u(!1),f(`/payment-success/${t}`)):n.data.is_expired?(r||d.error(s("subscription.paymentExpired")),x(!1),u(!1),await N()):r||d.info(s("subscription.paymentPending"))}catch(n){console.error("Error checking payment status:",n),r||d.error(s("subscription.paymentStatusError"))}finally{L(!1)}},I=()=>{x(!1),u(!1),k(300),p.current&&clearInterval(p.current)},D=t=>t==="free"?!0:a!=null&&a.user_subscription_types?a.user_subscription_types.includes(t):!1,F=()=>{if(!(a!=null&&a.user_subscription_types)||a.user_subscription_types.length===0)return"free";const t={vip:3,support:2,free:1};let r="free",n=1;for(const l of a.user_subscription_types)t[l]>n&&(r=l,n=t[l]);return r},G=t=>{if(t==="free"||!(a!=null&&a.user_subscriptions))return null;const r=a.user_subscriptions.find(n=>n.tier_slug===t);return(r==null?void 0:r.days_remaining)||null},H=[...a!=null&&a.plans?Object.entries(a.plans).map(([t,r])=>{var n;return{type:t==="member"?"free":t,name:r.name,price:`${r.price.toLocaleString()} VND/month`,description:r.description,benefits:((n=r.features)==null?void 0:n.benefits)||[]}}):[]];return C?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-theme-blue"})}):e.jsx("div",{className:"min-h-screen dark:bg-theme-dark-bg py-12 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs(S.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"text-center mb-12",children:[e.jsx("h1",{className:"text-4xl font-bold text-theme-blue mb-4",children:s("subscription.subscriptions")}),e.jsx("p",{className:"text-theme-text-secondary dark:text-theme-dark-text-secondary text-lg max-w-2xl mx-auto",children:s("subscription.subscriptionDescription")})]}),g&&Array.isArray(g)&&g.length>0&&e.jsxs(S.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"mb-8 p-4 bg-yellow-100 dark:bg-yellow-900 border border-yellow-400 dark:border-yellow-600 rounded-lg",children:[e.jsx("h3",{className:"text-lg font-semibold text-yellow-800 dark:text-yellow-200 mb-2",children:s("subscription.pendingPayments")}),e.jsx("div",{className:"space-y-2",children:(g||[]).map((t,r)=>{var n,l;return e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-yellow-700 dark:text-yellow-300",children:[(n=t.notes)==null?void 0:n.replace("Payment reference: ","")," - ",(l=t.amount)==null?void 0:l.toLocaleString()," VND"]}),e.jsx("button",{onClick:()=>{var R;return P((R=t.notes)==null?void 0:R.replace("Payment reference: ",""))},disabled:j,className:"px-3 py-1 bg-yellow-600 hover:bg-yellow-700 text-white rounded text-xs disabled:opacity-50",children:s(j?"subscription.checking":"subscription.checkStatus")})]},r)})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8 max-w-6xl mx-auto",children:H.map((t,r)=>e.jsx(S.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:r*.1},children:e.jsx(Z,{type:t.type,name:t.name,price:t.price,description:t.description,benefits:t.benefits,isOwned:D(t.type),expiresIn:G(t.type),onBuyClick:z,isCurrentTier:t.type===F()})},t.type))}),h&&i&&e.jsx(Y,{isOpen:h,onClose:I,children:e.jsxs("div",{className:"bg-theme-bg-primary dark:bg-theme-dark-card rounded-lg p-6 max-w-md mx-auto",children:[e.jsxs("h3",{className:"text-xl font-bold text-theme-blue mb-4 text-center",children:[s("subscription.buyNow")," - ",y==null?void 0:y.toUpperCase()]}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"text-2xl font-mono font-bold mb-2 text-theme-blue dark:text-theme-blue",children:V(b)}),e.jsx("p",{className:"text-sm text-theme-text-muted dark:text-theme-dark-text-secondary",children:s("subscription.timeRemaining")})]}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("p",{className:"text-theme-text-secondary dark:text-theme-dark-text-secondary mb-2",children:[s("subscription.amount"),": ",(O=i.amount)==null?void 0:O.toLocaleString()," VND"]}),e.jsx("p",{className:"text-sm text-theme-text-muted dark:text-theme-dark-text-secondary mb-4",children:s("subscription.scanQRCode")})]}),e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx("img",{src:i.qr_url,alt:"Payment QR Code",className:"w-48 h-48 border border-gray-200 rounded-lg"})}),e.jsx("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("svg",{className:"w-5 h-5 text-red-600 dark:text-red-400 mt-0.5 mr-2 flex-shrink-0",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-medium text-red-800 dark:text-red-200 mb-1",children:s("subscription.momoWarningTitle")}),e.jsx("p",{className:"text-red-700 dark:text-red-300",children:s("subscription.momoWarningText")})]})]})}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("p",{className:"text-xs text-theme-text-muted dark:text-theme-dark-text-secondary mb-2",children:[s("subscription.paymentReference"),":"]}),e.jsx("p",{className:"text-xs text-theme-text-primary dark:text-theme-dark-text font-mono bg-theme-bg-tertiary dark:bg-theme-dark-bg-secondary p-2 rounded",children:i.payment_reference}),i.expires_at&&e.jsxs("p",{className:"text-xs text-theme-text-muted dark:text-theme-dark-text-secondary mt-2",children:[s("subscription.expiresAt"),": ",new Date(i.expires_at).toLocaleString()]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>P(i.payment_reference),disabled:j||b===0,className:"flex-1 bg-theme-blue hover:bg-theme-blue-dark text-white px-4 py-2 rounded-lg transition-colors disabled:opacity-50",children:s(j?"subscription.checking":"subscription.checkStatus")}),e.jsx("button",{onClick:I,className:"flex-1 bg-theme-text-muted hover:bg-theme-text-secondary dark:bg-theme-dark-border dark:hover:bg-theme-dark-hover text-white px-4 py-2 rounded-lg transition-colors",children:s("subscription.close")})]})]})})]})})};export{re as default};
