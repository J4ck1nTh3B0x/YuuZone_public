import{a as se,u as re,c as ae,A as ee,r as a,Q as C,j as e,b as ce,S as we,y as Ne,B as de,M as le}from"./vendor_react_core-BQ601SDD.js";import{a as B}from"./vendor_axios-NIGUFBhG.js";import{a8 as oe,P as _e}from"./vendor_other-CYhXLBgr.js";import"./vendor_socket_io_client-BJzX-5m1.js";me.propTypes={setModal:_e.func};function me({setModal:t}){const{t:d}=se(),m=re(),r=ae(),{user:N}=ee(),[l,g]=a.useState(N.bio),[b,u]=a.useState(""),[o,i]=a.useState("image"),[n,h]=a.useState(""),[p,T]=a.useState(!1),[P,R]=a.useState(""),[D,f]=a.useState(!1),[y,v]=a.useState([]),[s,E]=a.useState(!1),[k,F]=a.useState(null),j=a.useCallback(x=>/(jpg|jpeg|png|webp|avif|gif|svg|image)/.test(x),[]);a.useCallback(x=>!x||typeof x!="string"?!1:/\.(mp4|webm|ogg|avi|mov|wmv|flv|mkv)(\?.*)?$/i.test(x)?!0:[/youtube\.com|youtu\.be/i,/vimeo\.com/,/dailymotion\.com/,/facebook\.com.*\/videos/,/twitch\.tv/,/streamable\.com/,/tiktok\.com/,/instagram\.com.*\/reel/,/twitter\.com.*\/video/,/x\.com.*\/video/].some(X=>X.test(x)),[]);const _=a.useCallback(()=>{let x="";o==="image"&&b?x=URL.createObjectURL(b):o==="url"&&n?x=n:o==="available_avatar"&&k&&(x=k.avatar_data.image_url),x&&(R(x),T(!0))},[o,b,n,k]),$=a.useCallback(()=>{T(!1),o==="image"&&b&&P.startsWith("blob:")&&URL.revokeObjectURL(P)},[o,b,P]),I=a.useCallback(x=>{x.target===x.currentTarget&&$()},[$]),L=a.useCallback(async()=>{try{E(!0);const x=await B.get("/api/coins/avatars/owned");x.data.success&&v(x.data.avatars)}catch(x){console.error("Error fetching owned avatars:",x),C.error(d("coins.fetchError"))}finally{E(!1)}},[d]),Q=a.useCallback(x=>{F(x),f(!1)},[]);a.useEffect(()=>{o!=="available_avatar"?(F(null),f(!1)):f(!0)},[o]),a.useEffect(()=>{D&&(!y||!Array.isArray(y)||y.length===0)&&L()},[D,y==null?void 0:y.length,L]);async function O(x){x==null||x.preventDefault();const H=new FormData;H.append("bio",l),H.append("content_type",o),H.append("content_url",n),o==="image"&&b?H.append("avatar",b,b.name):o==="available_avatar"&&k&&H.append("avatar_id",k.avatar_id),await B.patch("/api/user",H,{headers:{"Content-Type":"multipart/form-data"}}).then(q=>{t(!1),m.setQueryData(["user",N.username],()=>q.data),m.setQueryData(["user"],()=>q.data)}).catch(q=>C.error(`${q.message} ${d("alerts.checkYourFields")}`))}return a.useEffect(()=>(oe.setFocused(!1),()=>{oe.setFocused(!0),P&&P.startsWith("blob:")&&URL.revokeObjectURL(P)}),[P]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col p-5 space-y-5 w-5/6 rounded-md min-h-3/6 md:w-3/4 md:p-10 bg-theme-light-gray2 dark:bg-theme-dark-card dark:text-theme-dark-text",children:[e.jsxs("div",{className:"flex flex-col justify-between items-center p-4 space-y-3 bg-theme-less-white dark:bg-theme-dark-bg rounded-lg md:flex-row md:space-y-0",children:[e.jsx("p",{className:"text-theme-text-primary dark:text-theme-dark-text",children:"Updating Profile for"}),e.jsx("img",{src:N.avatar||ce,className:"object-cover w-10 h-10 rounded-md md:w-14 md:h-14",alt:""}),e.jsx("p",{className:"text-theme-text-primary dark:text-theme-dark-text",children:N.username})]}),e.jsxs("form",{className:"flex flex-col p-5 space-y-5 bg-theme-less-white dark:bg-theme-dark-bg rounded-md",onSubmit:O,children:[e.jsxs("label",{htmlFor:"bio",className:"flex flex-col p-2 md:space-x-3 md:flex-row",children:[e.jsx("span",{className:"text-sm font-light text-theme-text-primary dark:text-theme-dark-text",children:"Bio"}),e.jsx("textarea",{value:l,onChange:x=>g(x.target.value),type:"text",name:"bio",id:"bio",className:"w-full h-20 max-h-28 border-b border-gray-800 dark:border-theme-dark-border focus:outline-none bg-transparent dark:text-theme-dark-text dark:placeholder-theme-dark-placeholder-80"})]}),e.jsxs("label",{htmlFor:"media",className:"flex flex-col items-center space-y-3 md:space-y-0 md:space-x-5 md:flex-row",children:[e.jsxs("select",{className:"px-10 py-2 bg-theme-less-white dark:bg-theme-dark-bg rounded-md border dark:border-theme-dark-border md:px-12 dark:text-theme-dark-text",name:"media",id:"media",onChange:x=>i(x.target.value),children:[e.jsx("option",{value:"image",className:"dark:bg-theme-dark-bg dark:text-theme-dark-text",children:"Image"}),e.jsx("option",{value:"url",className:"dark:bg-theme-dark-bg dark:text-theme-dark-text",children:"URL"}),e.jsx("option",{value:"available_avatar",className:"dark:bg-theme-dark-bg dark:text-theme-dark-text",children:d("coins.availableAvatar")})]}),o==="image"?e.jsx("input",{onChange:x=>{x.target.files[0].size>10485760?C.error(d("alerts.fileTooLarge")):u(x.target.files[0])},type:"file",name:"file",accept:"image/*",id:"image",className:"w-full focus:outline-none dark:text-theme-dark-text"}):o==="url"?e.jsx("input",{type:"text",name:"media_url",id:"media_url",className:"p-2 w-full rounded-md border border-gray-800 dark:border-theme-dark-border focus:outline-none bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:placeholder-theme-dark-placeholder-80",onChange:x=>h(x.target.value)}):e.jsx("div",{className:"flex flex-col space-y-2 w-full",children:k?e.jsxs("div",{className:"flex items-center space-x-3 p-2 bg-theme-light-gray2 dark:bg-theme-dark-bg rounded-md",children:[e.jsx("img",{src:k.avatar_data.image_url,alt:k.avatar_data.name,className:"w-12 h-12 rounded-md object-cover"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-theme-text-primary dark:text-theme-dark-text",children:k.avatar_data.name}),e.jsx("p",{className:"text-xs text-theme-text-secondary dark:text-theme-dark-text-secondary",children:d("coins.chooseFromOwned")})]}),e.jsx("button",{type:"button",onClick:()=>F(null),className:"text-red-500 hover:text-red-700",children:"×"})]}):e.jsxs("div",{className:"flex items-center justify-center gap-2 px-4 py-2 bg-theme-light-gray2 dark:bg-theme-dark-bg rounded-md border border-gray-300 dark:border-theme-dark-border",children:[e.jsx(we,{type:"user",className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-theme-dark-text-secondary",children:d("coins.selectAvatar")})]})})]}),o==="image"&&b||o==="url"&&n||o==="available_avatar"&&k?e.jsx("button",{type:"button",onClick:_,className:"px-4 py-2 bg-theme-bg-secondary dark:bg-theme-dark-bg text-theme-text-primary dark:text-theme-dark-text rounded-md hover:bg-theme-bg-tertiary dark:hover:bg-theme-dark-card transition-colors",children:d("coins.previewAvatar")}):null,e.jsx("span",{className:"text-sm font-semibold text-red-500 dark:text-red-400",children:"Only Add Image if you want to modify the original image if empty the original will be used."}),e.jsx("button",{onClick:O,className:"py-2 font-semibold text-white rounded-md bg-theme-blue active:scale-95 dark:bg-theme-blue dark:hover:bg-theme-blue-coral",children:d("common.submit")})]})]}),D&&e.jsx("div",{className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",children:e.jsxs("div",{className:"bg-theme-less-white dark:bg-theme-dark-card p-6 rounded-md shadow-md max-w-4xl w-full max-h-[80vh] overflow-y-auto dark:text-theme-dark-text",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold dark:text-theme-dark-text-secondary",children:d("coins.selectAvatar")}),e.jsx("button",{onClick:()=>f(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:"×"})]}),s?e.jsx("div",{className:"flex justify-center items-center py-8",children:e.jsx("div",{className:"w-8 h-8 border-4 border-theme-blue border-t-transparent rounded-full animate-spin"})}):!y||!Array.isArray(y)||y.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-4xl mb-4",children:"👤"}),e.jsx("h4",{className:"text-lg font-medium text-theme-text-primary dark:text-theme-dark-text mb-2",children:d("coins.noAvatarsOwned")}),e.jsx("p",{className:"text-theme-text-secondary dark:text-theme-dark-text-secondary mb-4",children:d("coins.noAvatarsDescription")}),e.jsx("button",{onClick:()=>{f(!1),r("/coin-shop")},className:"bg-theme-blue text-white py-2 px-4 rounded-md hover:bg-blue-600 transition-colors",children:d("coins.goToAvatarShop")})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(y||[]).map(x=>{const H=x.avatar_data;return H?e.jsx("div",{className:`bg-theme-bg-primary dark:bg-theme-dark-bg rounded-lg border-2 p-4 hover:shadow-lg transition-shadow cursor-pointer ${x.is_equipped?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-theme-border-light dark:border-theme-dark-border"}`,onClick:()=>Q(x),children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx("img",{src:H.image_url,alt:H.name,className:"w-20 h-20 mx-auto rounded-lg object-cover",onError:q=>{q.target.src="https://via.placeholder.com/80x80?text=Avatar"}}),x.is_equipped&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs",children:"✓"})]}),e.jsx("h4",{className:"text-sm font-medium text-theme-text-primary dark:text-theme-dark-text mb-1",children:H.name}),e.jsx("p",{className:"text-xs text-theme-text-secondary dark:text-theme-dark-text-secondary",children:x.is_equipped?d("coins.equipped"):d("coins.owned")})]})},x.id):null})})]})}),e.jsx(Ne,{children:p&&e.jsx(de.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-75 z-50",onClick:I,children:e.jsxs(de.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:0},className:"relative max-w-4xl max-h-[90vh] overflow-auto bg-white dark:bg-theme-dark-card rounded-lg shadow-xl",onClick:x=>x.stopPropagation(),children:[e.jsxs("div",{className:"flex items-center justify-between p-4 border-b border-gray-200 dark:border-theme-dark-border",children:[e.jsx("h3",{className:"text-lg font-semibold text-theme-text-primary dark:text-theme-dark-text",children:d("coins.previewAvatar")}),e.jsx("button",{onClick:$,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 text-2xl",children:"×"})]}),e.jsx("div",{className:"relative",children:j(P)?e.jsx("div",{className:"relative",children:e.jsx("img",{src:P,alt:"Preview",className:"max-w-full max-h-[70vh] object-contain"})}):e.jsx("div",{className:"relative w-full h-96",children:e.jsx("iframe",{src:P,className:"w-full h-full",frameBorder:"0",allowFullScreen:!0,title:"Video Preview"})})})]})})})]})}const Ce=({disableModal:t=!1,onThemeCreated:d=null,themeSlotsData:m=null})=>{const{t:r}=se(),N=ee(),{switchToCustomTheme:l,switchToSystemTheme:g}=N;a.useEffect(()=>{(!l||!g)&&console.warn("Theme functions not available:",{switchToCustomTheme:typeof l,switchToSystemTheme:typeof g})},[l,g]);const[b,u]=a.useState([]),[o,i]=a.useState(!0),[n,h]=a.useState({available:0,used:0,total:0}),[p,T]=a.useState(!1),[P,R]=a.useState(!1),[D,f]=a.useState(null),[y,v]=a.useState({theme_name:"",theme_data:{}}),[s,E]=a.useState(!1),[k,F]=a.useState(null),[j,_]=a.useState(null),$={"theme-text-primary":"var(--theme-text-primary, #374151)","theme-text-secondary":"var(--theme-text-secondary, #6b7280)","theme-text-muted":"var(--theme-text-muted, #9ca3af)","theme-bg-primary":"var(--theme-bg-primary, #ffffff)","theme-bg-secondary":"var(--theme-bg-secondary, #f9fafb)","theme-bg-tertiary":"var(--theme-bg-tertiary, #f3f4f6)","theme-less-white":"var(--theme-less-white, #f4f4f4)","theme-light-gray2":"var(--theme-light-gray2, #dfdfdf)","theme-light-gray3":"var(--theme-light-gray3, #e7e5e5)","theme-pale-gray":"var(--theme-pale-gray, #eaeaea)","theme-border-light":"var(--theme-border-light, #e5e7eb)","theme-border-medium":"var(--theme-border-medium, #d1d5db)","theme-light-gray":"var(--theme-light-gray, #d9d9d9)","theme-blue":"var(--theme-blue, #37affe)","theme-blue-coral":"var(--theme-blue-coral, #3172ff)","theme-button-primary":"var(--theme-button-primary, #2563eb)","theme-button-primary-hover":"var(--theme-button-primary-hover, #1d4ed8)","theme-button-active":"var(--theme-button-active, #1e40af)","theme-button-disabled":"var(--theme-button-disabled, #9ca3af)","theme-link":"var(--theme-link, #2563eb)","theme-link-hover":"var(--theme-link-hover, #1d4ed8)","theme-success":"var(--theme-success, #059669)","theme-success-light":"var(--theme-success-light, #d1fae5)","theme-error":"var(--theme-error, #dc2626)","theme-error-light":"var(--theme-error-light, #fef2f2)","theme-warning":"var(--theme-warning, #d97706)","theme-warning-light":"var(--theme-warning-light, #fef3c7)","theme-info":"var(--theme-info, #2563eb)","theme-gray-blue":"var(--theme-gray-blue, #22638f)","theme-cultured":"var(--theme-cultured, #004b96)","theme-light-blue":"var(--theme-light-blue, #69bcff)","theme-pale-blue":"var(--theme-pale-blue, #93ceff)","theme-received":"var(--theme-received, #43b751)","theme-sender":"var(--theme-sender, #47acde)","theme-online":"var(--theme-online, #10b981)","theme-comment-border-1":"var(--theme-comment-border-1, #fbbf24)","theme-comment-border-2":"var(--theme-comment-border-2, #60a5fa)","theme-comment-border-3":"var(--theme-comment-border-3, #a78bfa)","theme-comment-border-4":"var(--theme-comment-border-4, #34d399)","theme-comment-border-5":"var(--theme-comment-border-5, #38bdf8)","theme-comment-border-6":"var(--theme-comment-border-6, #f472b6)"},I={"Text Colors":["theme-text-primary","theme-text-secondary","theme-text-muted"],"Page & Background":["theme-bg-primary","theme-bg-secondary","theme-bg-tertiary","theme-less-white"],"Cards & Containers":["theme-light-gray2","theme-light-gray3","theme-pale-gray"],"Borders & Dividers":["theme-border-light","theme-border-medium","theme-light-gray"],"Buttons & Interactive":["theme-blue","theme-blue-coral","theme-button-primary","theme-button-primary-hover","theme-button-active","theme-button-disabled"],Links:["theme-link","theme-link-hover"],"Status & Messages":["theme-success","theme-success-light","theme-error","theme-error-light","theme-warning","theme-warning-light","theme-info"],"Navigation & Brand":["theme-gray-blue","theme-cultured","theme-light-blue","theme-pale-blue"],"Chat & Messaging":["theme-received","theme-sender","theme-online"],"Comment Threads":["theme-comment-border-1","theme-comment-border-2","theme-comment-border-3","theme-comment-border-4","theme-comment-border-5","theme-comment-border-6"]};a.useEffect(()=>{m?(h({available:m.available_slots,used:m.used_slots,total:m.total_slots}),i(!1)):L(),Q()},[m]);const L=async()=>{try{const c=await B.get("/api/subscriptions/themes/slots");h(c.data)}catch(c){console.error("Error fetching theme slots:",c)}},Q=async()=>{try{i(!0);const c=await B.get("/api/subscriptions/themes");u(c.data.themes)}catch(c){console.error("Error fetching themes:",c),C.error(r("themes.errorLoadingThemes"))}finally{i(!1)}},O=async c=>{c.preventDefault();try{const S=await B.post("/api/subscriptions/themes",{theme_name:y.theme_name,theme_data:y.theme_data});C.success(r("themes.themeCreated")),s&&V(),T(!1),R(!1),v({theme_name:"",theme_data:{}}),Q(),L(),d&&d()}catch(S){console.error("Error creating theme:",S),C.error(r("themes.errorCreatingTheme"))}},x=async c=>{c.preventDefault();try{const S=await B.put(`/api/subscriptions/themes/${D.id}`,{theme_name:y.theme_name,theme_data:y.theme_data});C.success(r("themes.themeUpdated")),s&&V(),T(!1),f(null),v({theme_name:"",theme_data:{}}),Q()}catch(S){console.error("Error updating theme:",S),C.error(r("themes.errorUpdatingTheme"))}},H=async c=>{if(window.confirm(r("themes.confirmDeleteTheme")))try{await B.delete(`/api/subscriptions/themes/${c}`),C.success(r("themes.themeDeleted")),Q(),L()}catch(S){console.error("Error deleting theme:",S),C.error(r("themes.errorDeletingTheme"))}},q=async c=>{try{const w=(await B.post(`/api/subscriptions/themes/${c}/activate`)).data.theme;l&&typeof l=="function"?l(w):console.error("switchToCustomTheme function not available"),C.success(r("themes.themeActivated")),Q()}catch(S){console.error("Error activating theme:",S),C.error(r("themes.errorActivatingTheme"))}},X=async()=>{try{await B.post("/api/subscriptions/themes/deactivate"),g&&typeof g=="function"?g():console.error("switchToSystemTheme function not available"),C.success(r("themes.themesDeactivated")),Q()}catch(c){console.error("Error deactivating themes:",c),C.error(r("themes.errorDeactivatingThemes"))}},G=c=>{f(c),v({theme_name:c.theme_name,theme_data:{...c.theme_data}})},Y=()=>{s&&V(),T(!1),R(!1),f(null),v({theme_name:"",theme_data:{}})},J=(c,S)=>{v(w=>({...w,theme_data:{...w.theme_data,[c]:S}})),s&&F(w=>({...w,[c]:S}))},z=()=>{_(N.customTheme);const c={...y.theme_data};F(c),l&&typeof l=="function"&&l({id:"preview",theme_name:y.theme_name||"Preview Theme",theme_data:c}),E(!0),C.success(r("themes.previewStarted"))},V=()=>{j?l&&typeof l=="function"&&l(j):g&&typeof g=="function"&&g(),E(!1),F(null),_(null),C.success(r("themes.previewStopped"))};a.useEffect(()=>()=>{s&&V()},[s]);const Z=c=>({"theme-text-primary":"Main Text & Headings","theme-text-secondary":"Secondary Text & Captions","theme-text-muted":"Muted Text & Placeholders","theme-bg-primary":"Primary Background","theme-bg-secondary":"Secondary Background","theme-bg-tertiary":"Tertiary Background","theme-less-white":"Page Background","theme-light-gray2":"Background Cards","theme-light-gray3":"Secondary Borders","theme-pale-gray":"Button Hover Backgrounds","theme-border-light":"Light Borders","theme-border-medium":"Medium Borders","theme-light-gray":"Light Borders & Dividers","theme-blue":"Main Buttons & Links","theme-blue-coral":"Button Hover States","theme-button-primary":"Primary Buttons","theme-button-primary-hover":"Primary Button Hover","theme-button-active":"Active Button States","theme-button-disabled":"Disabled Buttons","theme-link":"Links","theme-link-hover":"Link Hover States","theme-success":"Success Messages & Confirmations","theme-success-light":"Success Backgrounds","theme-error":"Error Messages & Delete Buttons","theme-error-light":"Error Backgrounds","theme-warning":"Warning Messages & Alerts","theme-warning-light":"Warning Backgrounds","theme-info":"Info Messages","theme-gray-blue":"Navigation & Sidebar","theme-cultured":"Deep Blue Accents","theme-light-blue":"Light Blue Elements","theme-pale-blue":"Pale Blue Backgrounds","theme-received":"Received Message Background","theme-sender":"Sent Message Background","theme-online":"Online Status Indicator","theme-comment-border-1":"Comment Thread Border 1","theme-comment-border-2":"Comment Thread Border 2","theme-comment-border-3":"Comment Thread Border 3","theme-comment-border-4":"Comment Thread Border 4","theme-comment-border-5":"Comment Thread Border 5","theme-comment-border-6":"Comment Thread Border 6"})[c]||c.replace(/-/g," ").replace(/\b\w/g,w=>w.toUpperCase());if(o)return e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-theme-blue"})});const te=!o&&n.total>0;return P||n.available>0&&(!b||!Array.isArray(b)||b.length===0)?e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"bg-white dark:bg-theme-dark-bg p-4 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:["🎨 ",r("themes.createNewTheme")]}),s&&e.jsx("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full font-medium",children:r("themes.previewMode")})]}),e.jsx("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:e.jsx("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:r("themes.previewDescription")})}),e.jsxs("form",{onSubmit:O,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:r("themes.themeName")}),e.jsx("input",{type:"text",value:y.theme_name,onChange:c=>v(S=>({...S,theme_name:c.target.value})),className:"w-full p-2 border border-gray-300 dark:border-theme-dark-border rounded-md bg-white dark:bg-theme-dark-bg text-gray-900 dark:text-gray-100",placeholder:"Enter theme name",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium mb-2 text-gray-700 dark:text-gray-300",children:[r("themes.colorPalette")," - ",r("themes.allColorsAvailable")]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-6",children:Object.entries(I).map(([c,S])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-3 text-sm uppercase tracking-wide",children:c}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:S.map(w=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"color",value:y.theme_data[w]||$[w],onChange:W=>J(w,W.target.value),className:"w-8 h-8 border border-gray-300 rounded"}),s&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:Z(w)}),e.jsx("div",{className:"w-full h-2 rounded mt-1 border border-gray-200",style:{backgroundColor:y.theme_data[w]||$[w]}})]})]},w))})]},c))})]}),e.jsxs("div",{className:"flex space-x-3",children:[s?e.jsx("button",{type:"button",onClick:V,className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.stopPreview")}):e.jsx("button",{type:"button",onClick:z,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.previewTheme")}),e.jsx("button",{type:"submit",className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-4 py-2 rounded-md transition-colors",children:r("themes.createTheme")}),e.jsx("button",{type:"button",onClick:()=>R(!1),className:"bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-md transition-colors",children:r("common.cancel")})]})]})]})}):(p||D)&&t?e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:r(D?"themes.editTheme":"themes.createNewTheme")}),s&&e.jsx("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full font-medium",children:r("themes.previewMode")})]}),e.jsx("button",{onClick:Y,className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("form",{onSubmit:D?x:O,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:r("themes.themeName")}),e.jsx("input",{type:"text",value:y.theme_name,onChange:c=>v(S=>({...S,theme_name:c.target.value})),className:"w-full p-2 border border-gray-300 dark:border-theme-dark-border rounded-md bg-white dark:bg-theme-dark-bg text-gray-900 dark:text-gray-100",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[r("themes.colorPalette")," - ",r("themes.allColorsAvailable")]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-6",children:Object.entries(I).map(([c,S])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-3 text-sm uppercase tracking-wide",children:c}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:S.map(w=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"color",value:y.theme_data[w]||$[w],onChange:W=>J(w,W.target.value),className:"w-8 h-8 border border-gray-300 rounded"}),s&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:Z(w)}),e.jsx("div",{className:"w-full h-2 rounded mt-1 border border-gray-200",style:{backgroundColor:y.theme_data[w]||$[w]}})]})]},w))})]},c))})]}),e.jsxs("div",{className:"flex space-x-3",children:[s?e.jsx("button",{type:"button",onClick:V,className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.stopPreview")}):e.jsx("button",{type:"button",onClick:z,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.previewTheme")}),e.jsx("button",{type:"submit",className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-4 py-2 rounded-md transition-colors",children:r(D?"themes.updateTheme":"themes.createTheme")}),e.jsx("button",{type:"button",onClick:Y,className:"bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-md transition-colors",children:r("common.cancel")})]})]})]}):!o&&!te?e.jsxs("div",{className:"space-y-6 opacity-50 pointer-events-none",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("h4",{className:"text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200",children:r("themes.customThemes")})}),e.jsxs("div",{className:"bg-gray-100 dark:bg-gray-800 rounded-lg p-6 text-center",children:[e.jsx("div",{className:"text-gray-400 text-4xl mb-4",children:"🎨"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-600 dark:text-gray-400 mb-2",children:r("themes.customThemesLocked")}),e.jsx("p",{className:"text-gray-500 dark:text-gray-500 mb-4",children:r("themes.upgradeRequiredForThemes")}),e.jsx("button",{onClick:()=>window.location.href="/subscriptions",className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-6 py-2 rounded-md transition-colors pointer-events-auto",children:r("themes.upgradeToCreateThemes")})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-theme-light-gray2 dark:bg-theme-dark-bg rounded-lg p-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:r("themes.themeSlots")}),e.jsxs("div",{className:"flex items-center space-x-4 text-sm",children:[n.used>0?e.jsx("span",{children:r("themes.slotsLeft",{count:n.available})}):e.jsx("span",{children:r("themes.availableSlots",{count:n.available})}),e.jsx("span",{children:r("themes.usedSlots",{count:n.used})}),e.jsx("span",{children:r("themes.totalSlots",{count:n.total})})]}),b.some(c=>c.is_active)&&e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-2",children:r("themes.customThemeModeDescription")})]}),n.available===0&&n.total>0&&e.jsxs("div",{className:"bg-orange-50 dark:bg-orange-900/20 border border-orange-200 dark:border-orange-800 rounded-lg p-6 text-center",children:[e.jsx("div",{className:"text-orange-600 dark:text-orange-400 text-4xl mb-4",children:"📝"}),e.jsx("h3",{className:"text-lg font-semibold text-orange-800 dark:text-orange-200 mb-2",children:r("themes.allSlotsUsedTitle")}),e.jsx("p",{className:"text-orange-700 dark:text-orange-300 mb-4",children:r("themes.allSlotsUsedMessage")}),e.jsxs("div",{className:"flex space-x-3 justify-center",children:[e.jsx("button",{onClick:()=>window.location.href="/subscriptions",className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-4 py-2 rounded-md transition-colors",children:r("themes.upgradeForMoreSlots")}),e.jsx("button",{onClick:()=>T(!0),className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.manageExistingThemes")})]})]}),n.available>0&&e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-semibold",children:r("themes.yourThemes")}),e.jsx("button",{onClick:()=>{T(!0),R(!0)},className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-4 py-2 rounded-md transition-colors",children:r("themes.createNewTheme")})]}),b&&Array.isArray(b)&&b.length>0&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:(b||[]).map(c=>e.jsxs("div",{className:"bg-white dark:bg-theme-dark-card rounded-lg p-4 border border-gray-200 dark:border-theme-dark-border",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200",children:c.theme_name}),c.is_active&&e.jsx("span",{className:"bg-theme-success text-white text-xs px-2 py-1 rounded-full",children:r("themes.active")})]}),e.jsx("div",{className:"grid grid-cols-4 gap-1 mb-3",children:Object.entries(c.theme_data).slice(0,8).map(([S,w])=>e.jsx("div",{className:"w-6 h-6 rounded border border-gray-300",style:{backgroundColor:w},title:Z(S)},S))}),e.jsxs("div",{className:"flex space-x-2",children:[!c.is_active&&e.jsx("button",{onClick:()=>q(c.id),className:"bg-theme-success hover:bg-theme-success-light text-white px-3 py-1 rounded text-sm transition-colors",children:r("themes.activate")}),e.jsx("button",{onClick:()=>G(c),className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-3 py-1 rounded text-sm transition-colors",children:r("themes.edit")}),e.jsx("button",{onClick:()=>H(c.id),className:"bg-theme-error hover:bg-red-700 text-white px-3 py-1 rounded text-sm transition-colors",children:r("themes.delete")})]})]},c.id))}),(!b||!Array.isArray(b)||b.length===0)&&n.available>0&&e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"text-gray-400 dark:text-gray-500 text-4xl mb-3",children:"🎨"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:r("themes.noThemesYet")}),e.jsx("button",{onClick:()=>{T(!0),R(!0)},className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-6 py-2 rounded-md transition-colors",children:r("themes.createFirstTheme")})]}),(p||D)&&!t&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-theme-dark-card rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsx("div",{className:"flex items-center justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("h3",{className:"text-lg font-semibold",children:r(D?"themes.editTheme":"themes.createNewTheme")}),s&&e.jsx("span",{className:"bg-orange-100 text-orange-800 text-xs px-2 py-1 rounded-full font-medium",children:r("themes.previewMode")})]})}),e.jsxs("form",{onSubmit:D?x:O,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:r("themes.themeName")}),e.jsx("input",{type:"text",value:y.theme_name,onChange:c=>v(S=>({...S,theme_name:c.target.value})),className:"w-full p-2 border border-gray-300 dark:border-theme-dark-border rounded-md bg-white dark:bg-theme-dark-bg text-gray-900 dark:text-gray-100",required:!0})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:[r("themes.colorPalette")," - ",r("themes.allColorsAvailable")]}),e.jsx("div",{className:"max-h-96 overflow-y-auto space-y-6",children:Object.entries(I).map(([c,S])=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsx("h4",{className:"font-semibold text-gray-800 dark:text-gray-200 mb-3 text-sm uppercase tracking-wide",children:c}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:S.map(w=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"color",value:y.theme_data[w]||$[w],onChange:W=>J(w,W.target.value),className:"w-8 h-8 border border-gray-300 rounded"}),s&&e.jsx("div",{className:"absolute -top-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:Z(w)}),e.jsx("div",{className:"w-full h-2 rounded mt-1 border border-gray-200",style:{backgroundColor:y.theme_data[w]||$[w]}})]})]},w))})]},c))})]}),e.jsxs("div",{className:"flex space-x-3",children:[s?e.jsx("button",{type:"button",onClick:V,className:"bg-orange-600 hover:bg-orange-700 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.stopPreview")}):e.jsx("button",{type:"button",onClick:z,className:"bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.previewTheme")}),e.jsx("button",{type:"submit",className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-4 py-2 rounded-md transition-colors",children:r(D?"themes.updateTheme":"themes.createTheme")}),e.jsx("button",{type:"button",onClick:Y,className:"bg-gray-300 hover:bg-gray-400 text-gray-700 px-4 py-2 rounded-md transition-colors",children:r("common.cancel")})]})]})]})}),b.some(c=>c.is_active)&&e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:X,className:"bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md transition-colors",children:r("themes.deactivateAllThemes")})})]})};function Se(){const{socket:t,user:d}=ee(),m=re(),r=a.useCallback(u=>{const{theme:o,custom_theme:i}=u;m.setQueryData(["user"],n=>n&&{...n,theme:o||n.theme,custom_theme:i||n.custom_theme}),m.invalidateQueries(["user/theme"]),m.invalidateQueries(["user/custom-theme"]),console.log("Theme updated:",{theme:o,custom_theme:i})},[m]),N=a.useCallback(u=>{const{subscription_id:o,tier:i,status:n,expires_at:h}=u;m.setQueryData(["subscriptions"],p=>p&&(Array.isArray(p)?p.map(T=>T.id===o?{...T,tier:i,status:n,expires_at:h}:T):p)),m.setQueryData(["user"],p=>p&&{...p,tier:i||p.tier,subscription_status:n||p.subscription_status}),m.invalidateQueries(["subscriptions/user/settings-data"]),m.invalidateQueries(["subscriptions/themes/slots"]),m.invalidateQueries(["subscriptions/themes"]),console.log("Subscription updated:",{subscription_id:o,tier:i,status:n})},[m]),l=a.useCallback(u=>{const{theme_id:o,action:i,theme_data:n}=u;m.setQueryData(["subscriptions/themes"],h=>{if(!h)return h;switch(i){case"created":return{...h,themes:[n,...h.themes||[]]};case"updated":return{...h,themes:(h.themes||[]).map(p=>p.id===o?{...p,...n}:p)};case"deleted":return{...h,themes:(h.themes||[]).filter(p=>p.id!==o)};case"activated":return{...h,themes:(h.themes||[]).map(p=>({...p,is_active:p.id===o}))};case"deactivated":return{...h,themes:(h.themes||[]).map(p=>({...p,is_active:!1}))};default:return h}}),m.invalidateQueries(["subscriptions/themes/slots"]),console.log("Custom theme updated:",{theme_id:o,action:i})},[m]),g=a.useCallback(u=>{const{preference_type:o,value:i}=u;m.setQueryData(["user"],n=>n&&{...n,[o]:i}),m.invalidateQueries(["user/preferences"]),console.log("User preference updated:",{preference_type:o,value:i})},[m]),b=a.useCallback(u=>{const{used_count:o,limit:i,reset_date:n}=u;m.setQueryData(["translation/stats"],h=>h&&{...h,used_count:o||h.used_count,limit:i||h.limit,reset_date:n||h.reset_date}),m.invalidateQueries(["translation/history"]),console.log("Translation stats updated:",{used_count:o,limit:i})},[m]);return a.useEffect(()=>{if(!(!t||!d))return t.on("theme_updated",r),t.on("subscription_updated",N),t.on("custom_theme_updated",l),t.on("user_preference_updated",g),t.on("translation_stats_updated",b),t.emit("join_room",`user_settings_${d.id}`),()=>{t.off("theme_updated",r),t.off("subscription_updated",N),t.off("custom_theme_updated",l),t.off("user_preference_updated",g),t.off("translation_stats_updated",b),t.emit("leave_room",`user_settings_${d.id}`)}},[t,d,r,N,l,g,b]),{emitThemeUpdate:u=>t==null?void 0:t.emit("update_theme",u),emitSubscriptionUpdate:u=>t==null?void 0:t.emit("update_subscription",u),emitCustomThemeUpdate:u=>t==null?void 0:t.emit("update_custom_theme",u),emitUserPreferenceUpdate:u=>t==null?void 0:t.emit("update_user_preference",u)}}function Te(){const{socket:t}=ee(),d=a.useCallback(o=>{const{purchase_type:i,purchase_data:n}=o,h=new CustomEvent("purchaseHistoryUpdated",{detail:{type:"new_purchase",purchaseType:i,purchaseData:n}});window.dispatchEvent(h)},[]),m=a.useCallback(o=>{const{purchase_id:i,purchase_type:n,new_status:h}=o,p=new CustomEvent("purchaseHistoryUpdated",{detail:{type:"status_update",purchaseId:i,purchaseType:n,newStatus:h}});window.dispatchEvent(p)},[]),r=a.useCallback(o=>{const{tier_name:i,tier_slug:n,amount:h,currency:p,payment_status:T}=o,P=new CustomEvent("purchaseHistoryUpdated",{detail:{type:"new_purchase",purchaseType:"subscription",purchaseData:{id:`sub_${Date.now()}`,type:"subscription",tier_name:i,tier_slug:n,amount:h,currency:p,payment_status:T,created_at:new Date().toISOString(),description:`Subscription to ${i}`}}});window.dispatchEvent(P)},[]),N=a.useCallback(o=>{const{package_name:i,coin_amount:n,amount:h,currency:p,payment_status:T}=o,P=new CustomEvent("purchaseHistoryUpdated",{detail:{type:"new_purchase",purchaseType:"coin_purchase",purchaseData:{id:`coin_${Date.now()}`,type:"coin_purchase",package_name:i,coin_amount:n,amount:h,currency:p,payment_status:T,created_at:new Date().toISOString(),description:`Purchased ${n} coins`}}});window.dispatchEvent(P)},[]),l=a.useCallback(o=>{const{avatar_name:i,price_coins:n,avatar_image:h}=o,p=new CustomEvent("purchaseHistoryUpdated",{detail:{type:"new_purchase",purchaseType:"avatar_purchase",purchaseData:{id:`avatar_${Date.now()}`,type:"avatar_purchase",avatar_name:i,price_coins:n,avatar_image:h,created_at:new Date().toISOString(),description:`Purchased avatar: ${i}`}}});window.dispatchEvent(p)},[]),g=a.useCallback(o=>{const{post_id:i,cost:n}=o,h=new CustomEvent("purchaseHistoryUpdated",{detail:{type:"new_purchase",purchaseType:"post_boost",purchaseData:{id:`boost_${Date.now()}`,type:"post_boost",post_id:i,amount:-n,created_at:new Date().toISOString(),description:`Boosted post #${i}`}}});window.dispatchEvent(h)},[]),b=a.useCallback(o=>{const{tier_name:i,tier_slug:n,cost:h}=o,p=new CustomEvent("purchaseHistoryUpdated",{detail:{type:"new_purchase",purchaseType:"tier_purchase",purchaseData:{id:`tier_${Date.now()}`,type:"tier_purchase",tier_name:i,tier_slug:n,amount:-h,created_at:new Date().toISOString(),description:`Purchased tier: ${i}`}}});window.dispatchEvent(p)},[]);return a.useEffect(()=>{if(t)return t.on("new_purchase",d),t.on("purchase_status_updated",m),t.on("subscription_purchased",r),t.on("coin_purchase_complete",N),t.on("avatar_purchased",l),t.on("post_boosted",g),t.on("tier_purchased",b),()=>{t.off("new_purchase",d),t.off("purchase_status_updated",m),t.off("subscription_purchased",r),t.off("coin_purchase_complete",N),t.off("avatar_purchased",l),t.off("post_boosted",g),t.off("tier_purchased",b)}},[t,d,m,r,N,l,g,b]),{emitPurchaseUpdate:a.useCallback(o=>{t&&t.emit("purchase_update",o)},[t])}}const Pe=({user:t,language:d,handleLanguageChange:m,showUpdateProfile:r,setShowUpdateProfile:N,newUsername:l,setNewUsername:g,newPassword:b,setNewPassword:u,confirmPassword:o,setConfirmPassword:i,newEmail:n,setNewEmail:h,currentPassword:p,setCurrentPassword:T,showChangeUsername:P,setShowChangeUsername:R,showChangePassword:D,setShowChangePassword:f,showChangeEmail:y,setShowChangeEmail:v,handleUsernameChange:s,handlePasswordChange:E,handleEmailChange:k,setShowDeleteModal:F,t:j})=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:j("settings.profile")}),e.jsx("button",{onClick:()=>N(!0),className:"px-4 py-2 bg-theme-blue text-white rounded-md hover:bg-blue-600",children:j("settings.updateProfile")})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-theme-text-primary dark:text-theme-dark-text",children:j("settings.language")}),e.jsx("div",{className:"flex space-x-2",children:["ENG","JAP","VIE"].map(_=>e.jsx("button",{onClick:()=>m(_),className:`px-4 py-2 rounded-md ${d===_?"bg-theme-blue text-white":"bg-gray-200 dark:bg-theme-dark-bg text-gray-700 dark:text-theme-dark-text hover:bg-gray-300 dark:hover:bg-theme-dark-hover"}`,children:_},_))})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-theme-text-primary dark:text-theme-dark-text",children:j("settings.username")}),P?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"text",placeholder:j("settings.newUsername"),value:l,onChange:_=>g(_.target.value),className:"w-full p-2 border rounded-md bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80"}),e.jsx("input",{type:"password",placeholder:j("settings.currentPassword"),value:p,onChange:_=>T(_.target.value),className:"w-full p-2 border rounded-md bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:s,className:"px-4 py-2 bg-theme-blue text-white rounded-md hover:bg-blue-600 dark:hover:bg-theme-blue-coral",children:j("common.save")}),e.jsx("button",{onClick:()=>{R(!1),g(""),T("")},className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700",children:j("common.cancel")})]})]}):e.jsx("button",{onClick:()=>R(!0),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700",children:j("settings.changeUsername")})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-theme-text-primary dark:text-theme-dark-text",children:j("settings.password")}),D?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"password",placeholder:j("settings.currentPassword"),value:p,onChange:_=>T(_.target.value),className:"w-full p-2 border rounded-md bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80"}),e.jsx("input",{type:"password",placeholder:j("settings.newPassword"),value:b,onChange:_=>u(_.target.value),className:"w-full p-2 border rounded-md bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80"}),e.jsx("input",{type:"password",placeholder:j("settings.confirmNewPassword"),value:o,onChange:_=>i(_.target.value),className:"w-full p-2 border rounded-md bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:E,className:"px-4 py-2 bg-theme-blue text-white rounded-md hover:bg-blue-600 dark:hover:bg-theme-blue-coral",children:j("settings.update")}),e.jsx("button",{onClick:()=>{f(!1),u(""),i(""),T("")},className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700",children:j("common.cancel")})]})]}):e.jsx("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700",children:j("settings.changePassword")})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-theme-text-primary dark:text-theme-dark-text",children:j("settings.email")}),y?e.jsxs("div",{className:"space-y-2",children:[e.jsx("input",{type:"email",name:"email",id:"email",autoComplete:"email",placeholder:j("settings.newEmail"),value:n,onChange:_=>h(_.target.value),className:"w-full p-2 border rounded-md bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80"}),e.jsx("input",{type:"password",placeholder:j("settings.currentPassword"),value:p,onChange:_=>T(_.target.value),className:"w-full p-2 border rounded-md bg-theme-less-white dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:k,className:"px-4 py-2 bg-theme-blue text-white rounded-md hover:bg-blue-600 dark:hover:bg-theme-blue-coral",children:j("settings.update")}),e.jsx("button",{onClick:()=>{v(!1),h(""),T("")},className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700",children:j("common.cancel")})]})]}):e.jsx("button",{onClick:()=>v(!0),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700",children:j("settings.changeEmail")})]}),e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-red-600 dark:text-red-400",children:j("settings.dangerZone")}),e.jsx("button",{onClick:()=>F(!0),className:"px-4 py-2 !bg-red-600 !text-white rounded-md hover:!bg-red-700 dark:!bg-red-600 dark:hover:!bg-red-700",children:j("settings.deleteAccount")})]})]}),Ue=({translationStats:t,loadingStats:d,translationHistory:m,loadingHistory:r,selectedDate:N,setSelectedDate:l,showHistory:g,setShowHistory:b,fetchTranslationHistory:u,fetchTranslationStats:o,t:i})=>e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-theme-text-primary dark:text-theme-dark-text",children:i("translation.translationUsage")}),d?e.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[i("common.loading"),"..."]}):t?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsxs("span",{className:"text-blue-800 dark:text-blue-200 font-medium",children:[i("translation.monthlyLimit"),":"]}),e.jsx("span",{className:"text-blue-700 dark:text-blue-300 ml-2",children:t.limit===-1?i("translation.translationUsageUnlimited"):t.limit})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-blue-800 dark:text-blue-200 font-medium",children:[i("translation.translationsUsed"),":"]}),e.jsx("span",{className:"text-blue-700 dark:text-blue-300 ml-2",children:t.used})]}),e.jsxs("div",{children:[e.jsxs("span",{className:"text-blue-800 dark:text-blue-200 font-medium",children:[i("translation.translationsRemaining"),":"]}),e.jsx("span",{className:"text-blue-700 dark:text-blue-300 ml-2",children:t.remaining===-1?i("translation.translationUsageUnlimited"):t.remaining})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-800 dark:text-blue-200 font-medium",children:i("translation.translationUsageRole")}),e.jsx("span",{className:"text-blue-700 dark:text-blue-300 ml-2",children:t.role==="vip"?i("translation.translationUsageVIP"):t.role==="admin"?i("translation.translationUsageAdmin"):t.role==="mod"?i("translation.translationUsageMod"):t.role==="support"?i("translation.translationUsageSupport"):i("translation.translationUsageMember")})]})]}),t.limit!==-1&&e.jsxs("div",{className:"mt-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-blue-600 dark:text-blue-400 mb-1",children:[e.jsx("span",{children:i("translation.translationUsageDescription",{used:t.used,limit:t.limit})}),e.jsxs("span",{children:[Math.round(t.used/t.limit*100),"%"]})]}),e.jsx("div",{className:"w-full bg-blue-200 dark:bg-blue-800 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-600 dark:bg-blue-400 h-2 rounded-full transition-all duration-300",style:{width:`${Math.min(t.used/t.limit*100,100)}%`}})})]}),e.jsx("div",{className:"mt-3 text-xs text-blue-600 dark:text-blue-400",children:i("translation.translationUsageReset")})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h4",{className:"text-md font-semibold text-blue-800 dark:text-blue-200",children:i("translation.translationHistory")}),e.jsx("button",{onClick:()=>{b(!g),g||u()},className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 font-medium",children:i(g?"translation.hideHistory":"translation.showHistory")})]}),g&&e.jsxs("div",{className:"bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:[i("translation.selectDate"),":"]}),e.jsx("input",{type:"date",value:N,onChange:n=>{l(n.target.value),u(n.target.value)},className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"})]}),r?e.jsxs("div",{className:"text-center py-4",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:[i("common.loading"),"..."]})]}):m&&Array.isArray(m)&&m.length>0?e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:(m||[]).map((n,h)=>e.jsxs("div",{className:"border border-gray-200 dark:border-gray-600 rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-xs px-2 py-1 bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 rounded",children:n.post_id?i("translation.post"):i("translation.comment")}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400",children:new Date(n.translated_at).toLocaleTimeString()})]}),e.jsxs("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[n.source_language," → ",n.target_language]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("translation.originalText"),":"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-gray-700 p-2 rounded",children:(n.original_text||"").length>200?`${n.original_text.substring(0,200)}...`:n.original_text})]}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-xs font-medium text-gray-700 dark:text-gray-300 mb-1",children:[i("translation.translatedText"),":"]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 bg-green-50 dark:bg-green-900/20 p-2 rounded",children:(n.translated_text||"").length>200?`${n.translated_text.substring(0,200)}...`:n.translated_text})]})]})]},n.id||h))}):e.jsx("div",{className:"text-center py-4",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:i("translation.noHistoryForDate")})})]})]})]}):e.jsx("div",{className:"text-gray-600 dark:text-gray-400",children:i("translation.translationServiceUnavailable")})]})}),Ee=({user:t,t:d,showThemeEditor:m,setShowThemeEditor:r,translationStats:N})=>{const l=ae(),[g,b]=a.useState(null),[u,o]=a.useState(null),[i,n]=a.useState(!0),[h,p]=a.useState(!1),[T,P]=a.useState(!1);a.useEffect(()=>{(async()=>{n(!0);try{const s=(await B.get("/api/subscriptions/user/settings-data")).data;b({current_tier:s.current_tier,subscriptions:s.subscriptions,user_subscription_types:s.user_subscription_types}),o(s.theme_slots)}catch(v){console.error("Failed to fetch subscription data, trying fallback...",v);try{const[s,E]=await Promise.all([B.get("/api/subscriptions/user/tier-status").catch(k=>(console.error("Failed to fetch user tier status, trying plans endpoint...",k),B.get("/api/subscriptions/plans"))),B.get("/api/subscriptions/themes/slots")]);b(s.data),o(E.data)}catch(s){console.error("Both endpoints failed:",s)}}finally{n(!1)}})()},[]);const R=()=>{var E;const y=(E=g==null?void 0:g.subscriptions)==null?void 0:E.some(k=>k.status==="active"||k.status==="pending"),v=g==null?void 0:g.current_tier;if(y||v&&v!=="free"){let k=v;if(y&&!v){const F=(g==null?void 0:g.user_subscription_types)||[];F.includes("vip")?k="vip":F.includes("support")&&(k="support")}if(k==="support")return{tier:"support",name:"Support",description:"Support tier with enhanced features",daysRemaining:29,benefits:["Create up to 10 subthreads","Custom theme support","SUPPORT badge","Priority support","Enhanced file upload limits","Increased translation limits"]};if(k==="vip")return{tier:"vip",name:"VIP",description:"VIP tier with unlimited features",daysRemaining:29,benefits:["Unlimited subthreads","Custom theme support","VIP badge","Priority support","Unlimited file uploads","Unlimited translations"]}}return(t==null?void 0:t.username)==="kanw"?{tier:"support",name:"Support",description:"Support tier with enhanced features",daysRemaining:29,benefits:["Create up to 10 subthreads","Custom theme support","SUPPORT badge","Priority support","Enhanced file upload limits","Increased translation limits"]}:{tier:"free",name:"Free",description:"Basic user tier with limited features",daysRemaining:null,benefits:["Create up to 3 subthreads","Basic theme support","10MB file upload limit",`${(N==null?void 0:N.limit)||100} translations per month`]}},D=async()=>{var y,v;try{if(p(!0),(await B.post("/api/subscriptions/cancel")).data.success){C.success(d("subscription.cancellationSuccess")),P(!1);const E=await B.get("/api/subscriptions/user/tier-status");b(E.data)}}catch(s){console.error("Error cancelling subscription:",s),C.error(((v=(y=s.response)==null?void 0:y.data)==null?void 0:v.error)||d("subscription.cancellationError"))}finally{p(!1)}},f=g?R():{tier:"loading",name:"Loading...",description:"Loading subscription data...",daysRemaining:null,benefits:[]};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{className:"border-b pb-4",children:[e.jsx("h3",{className:"text-lg font-semibold mb-2 text-theme-text-primary dark:text-theme-dark-text",children:d("subscription.subscriptions")}),i||!g?e.jsxs("div",{className:"text-gray-600 dark:text-gray-400",children:[d("common.loading"),"..."]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200",children:d("subscription.currentSubscription")}),i?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-theme-blue"}),e.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading subscription data..."})]}):e.jsx(e.Fragment,{children:e.jsxs("div",{className:"bg-gradient-to-r from-blue-50 to-purple-50 dark:from-blue-900/20 dark:to-purple-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("h5",{className:"text-lg font-semibold text-blue-800 dark:text-blue-200",children:f.name}),e.jsx("span",{className:"px-3 py-1 bg-blue-100 dark:bg-blue-800 text-blue-800 dark:text-blue-200 text-xs font-medium rounded-full",children:f.tier.toUpperCase()})]}),e.jsx("p",{className:"text-sm text-blue-600 dark:text-blue-300 mb-3",children:f.description}),e.jsx("div",{className:"space-y-2",children:f.benefits.map((y,v)=>e.jsxs("div",{className:"flex items-center text-sm text-blue-700 dark:text-blue-300",children:[e.jsx("svg",{className:"w-4 h-4 mr-2 text-green-500",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})}),y]},v))}),f.tier!=="free"&&f.daysRemaining!==null&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex justify-between text-xs text-green-600 dark:text-green-400 mb-1",children:[e.jsxs("span",{children:["Subscription expires in ",f.daysRemaining," days"]}),e.jsxs("span",{children:[Math.max(0,Math.round(f.daysRemaining/30*100)),"% remaining"]})]}),e.jsx("div",{className:"w-full bg-green-200 dark:bg-green-800 rounded-full h-2",children:e.jsx("div",{className:"bg-green-600 dark:bg-green-400 h-2 rounded-full transition-all duration-300",style:{width:`${Math.max(0,Math.min(f.daysRemaining/30*100,100))}%`}})})]}),f.tier!=="free"&&e.jsxs("div",{className:"text-sm text-green-600 dark:text-green-400",children:["Your subscription is active and you have access to all ",f.name," features."]})]})})]}),u&&e.jsxs("div",{className:"bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-purple-800 dark:text-purple-200 font-semibold mb-3",children:[d("subscription.currentLimits"),":"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 border border-purple-200 dark:border-purple-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:d("subscription.themeSlots")}),e.jsxs("span",{className:"text-xs text-purple-600 dark:text-purple-400",children:[u.used_slots,"/",u.total_slots]})]}),e.jsx("div",{className:"w-full bg-purple-200 dark:bg-purple-800 rounded-full h-2",children:e.jsx("div",{className:"bg-purple-600 dark:bg-purple-400 h-2 rounded-full transition-all duration-300",style:{width:`${u.total_slots>0?u.used_slots/u.total_slots*100:0}%`}})}),e.jsx("div",{className:"text-xs text-purple-600 dark:text-purple-400 mt-1",children:u.available_slots>0?d("subscription.availableSlots",{count:u.available_slots}):d("subscription.noSlotsAvailable")})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 border border-purple-200 dark:border-purple-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:d("subscription.subthreadLimit")})}),e.jsx("div",{className:"text-lg font-semibold text-purple-800 dark:text-purple-200",children:f.tier==="vip"?d("subscription.unlimited"):f.tier==="support"?"10":"3"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 border border-purple-200 dark:border-purple-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:d("subscription.uploadLimit")})}),e.jsx("div",{className:"text-lg font-semibold text-purple-800 dark:text-purple-200",children:f.tier==="vip"?"100MB":f.tier==="support"?"50MB":"10MB"})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-3 border border-purple-200 dark:border-purple-700",children:[e.jsx("div",{className:"flex items-center justify-between mb-2",children:e.jsx("span",{className:"text-sm font-medium text-purple-700 dark:text-purple-300",children:d("subscription.translationLimit")})}),e.jsx("div",{className:"text-lg font-semibold text-purple-800 dark:text-purple-200",children:f.tier==="vip"?d("subscription.unlimited"):f.tier==="support"?`${(N==null?void 0:N.limit)||500}/month`:`${(N==null?void 0:N.limit)||100}/month`})]})]})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-4 border border-gray-200 dark:border-gray-700",children:[e.jsx("h4",{className:"text-lg font-semibold mb-4 text-gray-800 dark:text-gray-200",children:d("themes.customThemes")}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:d("themes.createAndManageThemes")}),i||f.tier==="loading"?e.jsxs("div",{className:"flex items-center justify-center py-6",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-theme-blue"}),e.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Loading theme data..."})]}):f.tier==="free"?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("div",{className:"text-gray-400 dark:text-gray-500 text-4xl mb-3",children:"🎨"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 mb-4",children:d("themes.upgradeToAccessThemes")}),e.jsx("button",{onClick:()=>l("/subscriptions"),className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-6 py-2 rounded-md transition-colors",children:d("subscription.buySubscription")})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex space-x-3",children:[u&&u.available_slots>0&&e.jsx("button",{onClick:()=>r(!0),className:"bg-theme-success hover:bg-theme-success-light text-white px-4 py-2 rounded-md transition-colors text-sm",children:d("themes.createNewTheme")}),u&&u.used_slots>0&&e.jsx("button",{onClick:()=>r(!0),className:"bg-theme-blue hover:bg-theme-blue-coral text-white px-4 py-2 rounded-md transition-colors text-sm",children:d("themes.viewThemes")})]}),u&&e.jsx("div",{className:"bg-gray-50 dark:bg-gray-700 rounded-lg p-3",children:e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("span",{className:"text-gray-600 dark:text-gray-400",children:[d("themes.themeSlots"),": ",u.used_slots,"/",u.total_slots]}),e.jsx("span",{className:`text-xs font-medium ${u.available_slots>0?"text-theme-success":"text-theme-warning"}`,children:u.available_slots>0?d("themes.availableSlots",{count:u.available_slots}):d("themes.noSlotsAvailable")})]})})]})]}),m&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-4xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 dark:text-gray-200",children:d("themes.customThemes")}),e.jsx("button",{onClick:()=>r(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx(Ce,{disableModal:!0,onThemeCreated:()=>r(!1),themeSlotsData:u})]})}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:()=>l("/subscriptions"),className:"px-4 py-2 bg-theme-blue text-white rounded-md hover:bg-theme-blue-coral transition-colors",children:f.tier==="free"?d("subscription.buySubscription"):d("subscription.manageSubscription")}),f.tier!=="free"&&e.jsx("button",{onClick:()=>P(!0),className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors",children:d("subscription.cancelSubscription")})]}),T&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg p-6 max-w-md w-full mx-4",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 text-6xl mb-4",children:"⚠️"}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-4",children:d("subscription.cancelSubscriptionTitle")}),e.jsx("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:d("subscription.cancelSubscriptionWarning")}),e.jsx("p",{className:"text-red-600 dark:text-red-400 text-sm mb-6",children:d("subscription.cancelSubscriptionImportant")}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("button",{onClick:D,disabled:h,className:"flex-1 px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:d(h?"common.loading":"subscription.confirmCancel")}),e.jsx("button",{onClick:()=>P(!1),disabled:h,className:"flex-1 px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed",children:d("common.cancel")})]})]})})})]})]})})},Ae=({t})=>{const[d,m]=a.useState([]),[r,N]=a.useState(!1),[l,g]=a.useState("all"),[b,u]=a.useState("all"),[o,i]=a.useState("newest"),[n,h]=a.useState(new Set);Te(),a.useEffect(()=>{p()},[]),a.useEffect(()=>{const s=E=>{const{type:k,purchaseType:F,purchaseData:j,purchaseId:_,newStatus:$}=E.detail;k==="new_purchase"?m(I=>{const L={...j,id:j.id||`new_${Date.now()}`,created_at:j.created_at||new Date().toISOString()};return I.some(O=>O.id===L.id)?I:(h(O=>new Set([...O,L.id])),setTimeout(()=>{h(O=>{const x=new Set(O);return x.delete(L.id),x})},5e3),[L,...I])}):k==="status_update"&&m(I=>I.map(L=>L.id===_||L.id===`sub_${_}`||L.id===`coin_${_}`||L.id===`avatar_${_}`||L.id===`boost_${_}`||L.id===`tier_${_}`?{...L,payment_status:$,is_active:$==="completed"||$==="active"}:L))};return window.addEventListener("purchaseHistoryUpdated",s),()=>{window.removeEventListener("purchaseHistoryUpdated",s)}},[]);const p=async()=>{N(!0);try{const s=await B.get("/api/subscriptions/purchase-history");s.data.success&&m(s.data.purchase_history)}catch(s){console.error("Failed to fetch purchase history:",s),C.error(t("settings.failedToLoadPurchaseHistory"))}finally{N(!1)}},T=s=>{switch(s){case"completed":case"active":return"text-green-600 dark:text-green-400";case"pending":return"text-yellow-600 dark:text-yellow-400";case"failed":case"cancelled":case"expired":return"text-red-600 dark:text-red-400";default:return"text-gray-600 dark:text-gray-400"}},P=s=>{if(s.expires_at){const E=new Date,k=new Date(s.expires_at);if(E>k&&s.payment_status==="pending")return"expired"}return s.payment_status||(s.is_active?"active":"inactive")},R=s=>s==="momo"?"bank":s,D=s=>s?new Date(s).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"N/A",f=(s,E="VND")=>s==null?"N/A":new Intl.NumberFormat("vi-VN",{style:"currency",currency:E}).format(s),v=[...d.filter(s=>{const E=l==="all"||s.type===l,k=P(s),F=b==="all"||k===b||s.is_active===(b==="active");return E&&F})].sort((s,E)=>{const k=new Date(s.created_at||0),F=new Date(E.created_at||0);return o==="newest"?F-k:k-F});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:t("settings.purchaseHistory")}),e.jsx("p",{className:"text-theme-text-secondary dark:text-theme-dark-text-secondary",children:t("settings.purchaseHistoryDescription")})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-text-primary dark:text-theme-dark-text mb-1",children:t("settings.filterByType")}),e.jsxs("select",{value:l,onChange:s=>g(s.target.value),className:"px-3 py-2 border border-theme-border-light dark:border-theme-dark-border rounded-md bg-theme-bg-primary dark:bg-theme-dark-bg text-theme-text-primary dark:text-theme-dark-text",children:[e.jsx("option",{value:"all",children:t("settings.allTypes")}),e.jsx("option",{value:"subscription",children:t("settings.subscription")}),e.jsx("option",{value:"coin_purchase",children:t("settings.coinPurchase")}),e.jsx("option",{value:"avatar_purchase",children:t("settings.avatarPurchase")}),e.jsx("option",{value:"post_boost",children:t("settings.postBoost")}),e.jsx("option",{value:"tier_purchase",children:t("settings.tierPurchase")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-text-primary dark:text-theme-dark-text mb-1",children:t("settings.filterByStatus")}),e.jsxs("select",{value:b,onChange:s=>u(s.target.value),className:"px-3 py-2 border border-theme-border-light dark:border-theme-dark-border rounded-md bg-theme-bg-primary dark:bg-theme-dark-bg text-theme-text-primary dark:text-theme-dark-text",children:[e.jsx("option",{value:"all",children:t("settings.allStatuses")}),e.jsx("option",{value:"completed",children:t("settings.completed")}),e.jsx("option",{value:"pending",children:t("settings.pending")}),e.jsx("option",{value:"failed",children:t("settings.failed")}),e.jsx("option",{value:"cancelled",children:t("settings.cancelled")}),e.jsx("option",{value:"active",children:t("settings.active")}),e.jsx("option",{value:"expired",children:t("settings.expired")})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-theme-text-primary dark:text-theme-dark-text mb-1",children:t("settings.sortByDate")}),e.jsxs("select",{value:o,onChange:s=>i(s.target.value),className:"px-3 py-2 border border-theme-border-light dark:border-theme-dark-border rounded-md bg-theme-bg-primary dark:bg-theme-dark-bg text-theme-text-primary dark:text-theme-dark-text",children:[e.jsx("option",{value:"newest",children:t("settings.newestFirst")}),e.jsx("option",{value:"oldest",children:t("settings.oldestFirst")})]})]})]}),r?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-theme-blue"}),e.jsxs("p",{className:"mt-2 text-sm text-theme-text-secondary dark:text-theme-dark-text-secondary",children:[t("settings.loading"),"..."]})]}):v&&Array.isArray(v)&&v.length>0?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("p",{className:"text-sm text-theme-text-secondary dark:text-theme-dark-text-secondary",children:[t("settings.totalPurchases"),": ",(v==null?void 0:v.length)||0]})}),e.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:(v||[]).map(s=>e.jsx("div",{className:`bg-theme-bg-primary dark:bg-theme-dark-bg border border-theme-border-light dark:border-theme-dark-border rounded-lg p-4 transition-all duration-300 ${n.has(s.id)?"ring-2 ring-green-400 shadow-lg animate-pulse":""}`,children:e.jsx("div",{className:"flex items-start justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx("h4",{className:"font-medium text-theme-text-primary dark:text-theme-dark-text",children:s.description||s.type}),n.has(s.id)&&e.jsx("span",{className:"text-xs px-2 py-1 bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 rounded-full animate-pulse",children:t("settings.new")}),e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${T(P(s))}`,children:P(s)})]}),e.jsxs("div",{className:"text-sm text-theme-text-secondary dark:text-theme-dark-text-secondary space-y-1",children:[e.jsxs("p",{children:[t("settings.purchaseDate"),": ",D(s.created_at)]}),s.amount&&e.jsxs("p",{children:[t("settings.purchaseAmount"),": ",f(s.amount,s.currency)]}),s.coin_amount&&e.jsxs("p",{children:[t("settings.coinAmount"),": ",s.coin_amount," ",t("coins.coins")]}),s.tier_name&&e.jsxs("p",{children:[t("settings.tierName"),": ",s.tier_name]}),s.avatar_name&&e.jsxs("p",{children:[t("settings.avatarName"),": ",s.avatar_name]}),s.post_id&&e.jsxs("p",{children:[t("settings.postId"),": #",s.post_id]}),s.payment_method&&e.jsxs("p",{children:[t("settings.paymentMethod"),": ",R(s.payment_method)]}),s.balance_after&&e.jsxs("p",{children:[t("settings.balanceAfter"),": ",s.balance_after," ",t("coins.coins")]})]})]})})},s.id))})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("h3",{className:"text-lg font-medium text-theme-text-primary dark:text-theme-dark-text mb-2",children:t("settings.noPurchases")}),e.jsx("p",{className:"text-theme-text-secondary dark:text-theme-dark-text-secondary",children:t("settings.noPurchasesDescription")})]})]})};function Fe(){const t=ae(),d=re(),{user:m,customTheme:r,setCustomTheme:N}=ee(),{t:l,i18n:g}=se();Se();const[b,u]=a.useState("general"),[o,i]=a.useState(!1),[n,h]=a.useState(null),[p,T]=a.useState(!1),[P,R]=a.useState(()=>({en:"ENG",ja:"JAP",vi:"VIE"})[g.language]||"ENG"),[D,f]=a.useState(""),[y,v]=a.useState(""),[s,E]=a.useState(""),[k,F]=a.useState(""),[j,_]=a.useState(""),[$,I]=a.useState(""),[L,Q]=a.useState(!1),[O,x]=a.useState(!1),[H,q]=a.useState(!1),[X,G]=a.useState(!1),[Y,J]=a.useState(!1),[z,V]=a.useState(!1),[Z,te]=a.useState([]),[ne,c]=a.useState(!1),[S,w]=a.useState(new Date().toISOString().split("T")[0]),[W,he]=a.useState(!1),[ue,xe]=a.useState(!1);a.useEffect(()=>{const A=new URLSearchParams(window.location.search).get("tab");A&&["general","translation","themes","subscription"].includes(A)&&u(A)},[]),a.useEffect(()=>(document.title=`${l("settings.settings")} - YuuZone`,()=>document.title="YuuZone"),[l]),a.useEffect(()=>{m&&b==="translation"&&!n&&ie()},[m,b,n]);const ie=async(U=!1)=>{if(!(n&&!U)){T(!0);try{const A=await B.get("/api/translate/stats");h(A.data)}catch(A){console.error("Failed to fetch translation stats:",A)}finally{T(!1)}}},be=async(U=S)=>{c(!0);try{const A=await B.get(`/api/translate/history?date=${U}`);te(A.data.history)}catch(A){console.error("Failed to fetch translation history:",A),C.error(l("translation.failedToLoadHistory"))}finally{c(!1)}},pe=async U=>{R(U);const M={ENG:"en",JAP:"ja",VIE:"vi"}[U]||"en";if(g.changeLanguage(M),localStorage.setItem("yuuzone_language",M),m)try{await B.patch("/api/user/language",{language:M})}catch{}},ge=async()=>{var A,M;const U=`sudo rm ${m.username}`;if(D!==U){C.error(l("settings.pleaseTypeExactly",{text:U}));return}J(!0),V(!0);try{await B.post("/api/user/request-deletion"),G(!1),f(""),C.success(l("settings.deletionVerificationSent")),setTimeout(()=>{t("/login")},2e3)}catch(K){const je=((M=(A=K.response)==null?void 0:A.data)==null?void 0:M.user_message)||l("settings.failedToDeleteAccount");C.error(je),J(!1),V(!1)}},ye=async()=>{var U,A;if(!y.trim()){C.error(l("settings.pleaseEnterNewUsername"));return}try{const M=new FormData;M.append("username",y),M.append("current_password",$);const K=await B.patch("/api/user/username",M);d.setQueryData(["user"],()=>K.data),Q(!1),v(""),I(""),C.success(l("settings.usernameUpdatedSuccessfully"))}catch(M){C.error(((A=(U=M.response)==null?void 0:U.data)==null?void 0:A.message)||l("settings.failedToUpdateUsername"))}},fe=async()=>{var U,A;if(!s||!k){C.error(l("settings.pleaseFillAllPasswordFields"));return}if(s!==k){C.error(l("settings.passwordsDoNotMatch"));return}try{const M=new FormData;M.append("new_password",s),M.append("current_password",$),await B.patch("/api/user/password",M),x(!1),E(""),F(""),I(""),C.success(l("settings.passwordUpdatedSuccessfully"))}catch(M){C.error(((A=(U=M.response)==null?void 0:U.data)==null?void 0:A.message)||l("settings.failedToUpdatePassword"))}},ve=async()=>{var U,A;if(!j.trim()){C.error(l("settings.pleaseEnterNewEmail"));return}try{const M=new FormData;M.append("email",j),M.append("current_password",$);const K=await B.patch("/api/user/email",M);d.setQueryData(["user"],()=>K.data),q(!1),_(""),I(""),C.success(l("settings.emailUpdatedSuccessfully"))}catch(M){C.error(((A=(U=M.response)==null?void 0:U.data)==null?void 0:A.message)||l("settings.failedToUpdateEmail"))}},ke=[{id:"general",label:l("settings.generalSettings")},{id:"translation",label:l("translation.translationUsage")},{id:"subscription",label:l("subscription.subscriptions")},{id:"purchase-history",label:l("settings.purchaseHistory")}];return e.jsxs("div",{className:"flex flex-col flex-1 items-center w-full bg-theme-light-gray2 dark:bg-theme-dark-bg dark:text-theme-dark-text p-4",children:[e.jsxs("div",{className:"w-full max-w-4xl bg-theme-less-white dark:bg-theme-dark-card dark:text-theme-dark-text border border-theme-border-light dark:border-theme-dark-border rounded-md p-6 shadow-md",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center text-theme-text-primary dark:text-theme-dark-text",children:l("settings.settings")}),e.jsxs("div",{className:"flex items-center space-x-4 p-4 bg-theme-light-gray2 dark:bg-theme-dark-bg rounded-md mb-6",children:[e.jsx("img",{src:m.avatar||ce,alt:l("settings.userAvatar"),className:"w-16 h-16 rounded-md object-cover"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold text-theme-text-primary dark:text-theme-dark-text",children:m.username}),e.jsxs("p",{className:"text-theme-text-secondary dark:text-theme-dark-text",children:[l("settings.karma"),": ",m.karma.user_karma]})]})]}),e.jsx("div",{className:"flex space-x-1 mb-6 bg-gray-100 dark:bg-gray-800 rounded-lg p-1",children:ke.map(U=>e.jsxs("button",{onClick:()=>u(U.id),className:`flex-1 flex items-center justify-center space-x-2 px-4 py-2 rounded-md text-sm font-medium transition-colors ${b===U.id?"bg-white dark:bg-gray-700 text-theme-blue shadow-sm":"text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200"}`,children:[e.jsx("span",{children:U.icon}),e.jsx("span",{children:U.label})]},U.id))}),e.jsxs("div",{className:"min-h-[400px]",children:[b==="general"&&e.jsx(Pe,{user:m,language:P,handleLanguageChange:pe,showUpdateProfile:o,setShowUpdateProfile:i,newUsername:y,setNewUsername:v,newPassword:s,setNewPassword:E,confirmPassword:k,setConfirmPassword:F,newEmail:j,setNewEmail:_,currentPassword:$,setCurrentPassword:I,showChangeUsername:L,setShowChangeUsername:Q,showChangePassword:O,setShowChangePassword:x,showChangeEmail:H,setShowChangeEmail:q,handleUsernameChange:ye,handlePasswordChange:fe,handleEmailChange:ve,setShowDeleteModal:G,t:l}),b==="translation"&&e.jsx(Ue,{translationStats:n,loadingStats:p,translationHistory:Z,loadingHistory:ne,selectedDate:S,setSelectedDate:w,showHistory:W,setShowHistory:he,fetchTranslationHistory:be,fetchTranslationStats:ie,t:l}),b==="subscription"&&e.jsx(Ee,{user:m,t:l,showThemeEditor:ue,setShowThemeEditor:xe,translationStats:n}),b==="purchase-history"&&e.jsx(Ae,{t:l})]})]}),X&&e.jsx(le,{setShowModal:G,children:e.jsxs("div",{className:"bg-theme-less-white dark:bg-theme-dark-card p-6 rounded-md shadow-md w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-bold text-red-600 dark:text-red-400 mb-4 text-center",children:l("settings.deleteAccount")}),e.jsx("p",{className:"mb-2 text-gray-700 dark:text-gray-300 text-center",children:l("settings.deleteAccountConfirm")}),e.jsx("p",{className:"mb-2 text-gray-700 dark:text-gray-300 text-center",children:l("settings.deleteConfirmation",{username:m.username})}),e.jsx("input",{type:"text",placeholder:`sudo rm ${m.username}`,value:D,onChange:U=>f(U.target.value),className:"w-full p-2 border rounded-md bg-theme-light-gray2 dark:bg-theme-dark-bg dark:text-theme-dark-text dark:border-theme-dark-border dark:placeholder-theme-dark-placeholder-80 mt-2 mb-4",disabled:z}),e.jsxs("div",{className:"flex space-x-2 justify-center",children:[e.jsx("button",{onClick:ge,className:"px-4 py-2 !bg-red-600 !text-white rounded-md hover:!bg-red-700 dark:!bg-red-600 dark:hover:!bg-red-700 disabled:opacity-50",disabled:z||Y,children:l(Y?"common.loading":"settings.deleteAccount")}),e.jsx("button",{onClick:()=>G(!1),className:"px-4 py-2 bg-gray-500 text-white rounded-md hover:bg-gray-600 dark:bg-gray-600 dark:hover:bg-gray-700",disabled:z,children:l("common.cancel")})]})]})}),o&&e.jsx(le,{showModal:o,setShowModal:i,children:e.jsx(me,{setModal:i})})]})}export{Fe as default};
