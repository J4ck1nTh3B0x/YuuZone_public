import{a as w,c as E,A as q,r as c,h as A,Q as m,j as e,S as x}from"./vendor_react_core-DBa5h3JB.js";import{a as y}from"./vendor_axios-NIGUFBhG.js";import"./vendor_other-ZJ5-vPoH.js";import"./vendor_socket_io_client-tnUwAcyt.js";function D(){var v;const{t}=w(),d=E(),{isAuthenticated:h,user:o}=q(),[r,j]=c.useState([]),[f,p]=c.useState(!0),[u,g]=c.useState(null);A(),c.useEffect(()=>{if(!h){d("/login");return}l()},[h,d]),c.useEffect(()=>{const a=s=>{const{newBalance:n,transactionType:i,avatarName:k}=s.detail;i==="avatar_purchase"&&k&&l()};return window.addEventListener("coinBalanceUpdated",a),()=>{window.removeEventListener("coinBalanceUpdated",a)}},[]);const l=async()=>{try{p(!0);const a=await y.get("/api/coins/avatars/owned");a.data.success&&j(a.data.avatars)}catch(a){console.error("Error fetching owned avatars:",a),m.error(t("coins.fetchError"))}finally{p(!1)}},N=async a=>{var s,n;try{g(!0),(await y.put("/api/coins/avatars/equip",{avatar_id:a})).data.success&&(m.success(t("coins.avatarEquipped")),l())}catch(i){console.error("Error equipping avatar:",i),m.error(((n=(s=i.response)==null?void 0:s.data)==null?void 0:n.error)||t("coins.equipError"))}finally{g(!1)}},b=()=>{d("/coin-shop")};return f?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-theme-blue"})}):e.jsx("div",{className:"min-h-screen bg-theme-light-gray2 dark:bg-theme-dark-bg pt-20 px-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsx("div",{className:"bg-white dark:bg-theme-dark-card rounded-lg shadow-md p-6 mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-theme-text-primary dark:text-theme-dark-text",children:t("coins.availableAvatars")}),e.jsx("p",{className:"text-theme-text-secondary dark:text-theme-dark-text-secondary mt-2",children:t("coins.availableAvatarsDescription")})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-2xl font-bold text-yellow-600 dark:text-yellow-400 flex items-center justify-end",children:[e.jsx(x,{type:"coin",className:"w-6 h-6 mr-2"}),((v=o==null?void 0:o.wallet)==null?void 0:v.coin_balance)||0," ",t("coins.coins")]}),e.jsx("p",{className:"text-sm text-theme-text-secondary dark:text-theme-dark-text-secondary",children:t("coins.yourBalance")})]})]})}),e.jsx("div",{className:"bg-white dark:bg-theme-dark-card rounded-lg shadow-md p-6",children:!r||!Array.isArray(r)||r.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"text-6xl mb-4",children:"ðŸ‘¤"}),e.jsx("h2",{className:"text-2xl font-bold text-theme-text-primary dark:text-theme-dark-text mb-4",children:t("coins.noAvatarsOwned")}),e.jsx("p",{className:"text-theme-text-secondary dark:text-theme-dark-text-secondary mb-6",children:t("coins.noAvatarsDescription")}),e.jsxs("button",{onClick:b,className:"bg-theme-blue text-white py-3 px-6 rounded-lg hover:bg-blue-600 transition-colors font-medium text-lg",children:[e.jsx(x,{type:"coin",className:"w-5 h-5 mr-2"}),t("coins.goToAvatarShop")]})]}):e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-theme-text-primary dark:text-theme-dark-text mb-6",children:[t("coins.yourAvatars")," (",(r==null?void 0:r.length)||0,")"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:(r||[]).map(a=>{const s=a.avatar_data;return s?e.jsx("div",{className:`bg-theme-bg-primary dark:bg-theme-dark-bg rounded-lg border-2 p-4 hover:shadow-lg transition-shadow ${a.is_equipped?"border-green-500 bg-green-50 dark:bg-green-900/20":"border-theme-border-light dark:border-theme-dark-border"}`,children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx("img",{src:s.image_url,alt:s.name,className:"w-24 h-24 mx-auto rounded-lg object-cover",onError:n=>{n.target.src="https://via.placeholder.com/96x96?text=Avatar"}}),a.is_equipped&&e.jsx("div",{className:"absolute -top-2 -right-2 bg-green-500 text-white rounded-full w-6 h-6 flex items-center justify-center text-xs",children:"âœ“"})]}),e.jsx("h3",{className:"text-lg font-bold text-theme-text-primary dark:text-theme-dark-text mb-2",children:s.name}),e.jsxs("p",{className:"text-sm text-theme-text-secondary dark:text-theme-dark-text-secondary mb-2",children:[t("coins.by")," ",s.creator_name||"YuuZone"]}),e.jsxs("p",{className:"text-sm text-theme-text-secondary dark:text-theme-dark-text-secondary mb-4",children:[t("coins.purchased"),": ",new Date(a.purchased_at).toLocaleDateString()]}),a.is_equipped?e.jsx("div",{className:"text-green-600 dark:text-green-400 font-medium",children:t("coins.equipped")}):e.jsx("button",{onClick:()=>N(s.id),disabled:u,className:"w-full bg-theme-blue text-white py-2 px-4 rounded-lg hover:bg-blue-600 transition-colors font-medium disabled:opacity-50",children:t(u?"coins.equipping":"coins.equip")})]})},a.id):null})}),e.jsx("div",{className:"mt-8 text-center",children:e.jsxs("button",{onClick:b,className:"bg-gray-500 text-white py-2 px-6 rounded-lg hover:bg-gray-600 transition-colors font-medium",children:[e.jsx(x,{type:"coin",className:"w-4 h-4 mr-2"}),t("coins.buyMoreAvatars")]})})]})})]})})}export{D as default};
